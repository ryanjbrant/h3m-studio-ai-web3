import{r as e,j as t,L as ue,b as me}from"./index-Ca5JFDiE.js";import{B as V,a as S,S as de,_ as F,s as te,b as _,Q as H,M as $,u as q,W as G,c as fe,d as re,e as he,f as Q,g as K,h as ve,i as Z,v as ne,j as pe,H as ge,N as X,k as xe,C as ye,O as be}from"./OrbitControls-DP0yiWgp.js";import{G as we,E as ae}from"./ErrorBoundary-BcqLfEQu.js";import{E as Me}from"./Environment-9eHqQL1Z.js";const je={uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:`
      varying vec2 vUv;

      void main() {

        vUv = uv;
        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

      }
  `,fragmentShader:`
    uniform sampler2D tDiffuse;
    uniform float h;

    varying vec2 vUv;

    void main() {

    	vec4 sum = vec4( 0.0 );

    	sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;
    	sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;

    	gl_FragColor = sum;

    }
  `},Se={uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:`
    varying vec2 vUv;

    void main() {

      vUv = uv;
      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

    }
  `,fragmentShader:`

  uniform sampler2D tDiffuse;
  uniform float v;

  varying vec2 vUv;

  void main() {

    vec4 sum = vec4( 0.0 );

    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;

    gl_FragColor = sum;

  }
  `},Ee=e.forwardRef(function({children:n,disable:a,disableX:s,disableY:u,disableZ:p,left:b,right:g,top:x,bottom:l,front:U,back:E,onCentered:m,precise:D=!0,cacheKey:w=0,...o},v){const d=e.useRef(null),c=e.useRef(null),M=e.useRef(null);return e.useLayoutEffect(()=>{c.current.matrixWorld.identity();const y=new V().setFromObject(M.current,D),f=new S,i=new de,h=y.max.x-y.min.x,j=y.max.y-y.min.y,C=y.max.z-y.min.z;y.getCenter(f),y.getBoundingSphere(i);const R=x?j/2:l?-j/2:0,P=b?-h/2:g?h/2:0,A=U?C/2:E?-C/2:0;c.current.position.set(a||s?0:-f.x+P,a||u?0:-f.y+R,a||p?0:-f.z+A),typeof m<"u"&&m({parent:d.current.parent,container:d.current,width:h,height:j,depth:C,boundingBox:y,boundingSphere:i,center:f,verticalAlignment:R,horizontalAlignment:P,depthAlignment:A})},[w,m,x,b,U,a,s,u,p,D,g,l,E]),e.useImperativeHandle(v,()=>d.current,[]),e.createElement("group",F({ref:d},o),e.createElement("group",{ref:c},e.createElement("group",{ref:M},n)))}),De=te({},"void main() { }","void main() { gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0); discard;  }");var T=function(r){return r[r.NONE=0]="NONE",r[r.START=1]="START",r[r.ACTIVE=2]="ACTIVE",r}(T||{});const I=r=>r&&r.isOrthographicCamera,Ce=r=>r&&r.isBox3,Ue=r=>1-Math.exp(-5*r)+.007*r,se=e.createContext(null);function Re({children:r,maxDuration:n=1,margin:a=1.2,observe:s,fit:u,clip:p,interpolateFunc:b=Ue,onFit:g}){const x=e.useRef(null),{camera:l,size:U,invalidate:E}=_(),m=_(f=>f.controls),D=e.useRef(g);D.current=g;const w=e.useRef({camPos:new S,camRot:new H,camZoom:1}),o=e.useRef({camPos:void 0,camRot:void 0,camZoom:void 0,camUp:void 0,target:void 0}),v=e.useRef(T.NONE),d=e.useRef(0),[c]=e.useState(()=>new V),M=e.useMemo(()=>{function f(){const i=c.getSize(new S),h=c.getCenter(new S),j=Math.max(i.x,i.y,i.z),C=I(l)?j*4:j/(2*Math.atan(Math.PI*l.fov/360)),R=I(l)?j*4:C/l.aspect,P=a*Math.max(C,R);return{box:c,size:i,center:h,distance:P}}return{getSize:f,refresh(i){if(Ce(i))c.copy(i);else{const h=i||x.current;if(!h)return this;h.updateWorldMatrix(!0,!0),c.setFromObject(h)}if(c.isEmpty()){const h=l.position.length()||10;c.setFromCenterAndSize(new S,new S(h,h,h))}return w.current.camPos.copy(l.position),w.current.camRot.copy(l.quaternion),I(l)&&(w.current.camZoom=l.zoom),o.current.camPos=void 0,o.current.camRot=void 0,o.current.camZoom=void 0,o.current.camUp=void 0,o.current.target=void 0,this},reset(){const{center:i,distance:h}=f(),j=l.position.clone().sub(i).normalize();o.current.camPos=i.clone().addScaledVector(j,h),o.current.target=i.clone();const C=new $().lookAt(o.current.camPos,o.current.target,l.up);return o.current.camRot=new H().setFromRotationMatrix(C),v.current=T.START,d.current=0,this},moveTo(i){return o.current.camPos=Array.isArray(i)?new S(...i):i.clone(),v.current=T.START,d.current=0,this},lookAt({target:i,up:h}){o.current.target=Array.isArray(i)?new S(...i):i.clone(),h?o.current.camUp=Array.isArray(h)?new S(...h):h.clone():o.current.camUp=l.up.clone();const j=new $().lookAt(o.current.camPos||l.position,o.current.target,o.current.camUp);return o.current.camRot=new H().setFromRotationMatrix(j),v.current=T.START,d.current=0,this},to({position:i,target:h}){return this.moveTo(i).lookAt({target:h})},fit(){if(!I(l))return this.reset();let i=0,h=0;const j=[new S(c.min.x,c.min.y,c.min.z),new S(c.min.x,c.max.y,c.min.z),new S(c.min.x,c.min.y,c.max.z),new S(c.min.x,c.max.y,c.max.z),new S(c.max.x,c.max.y,c.max.z),new S(c.max.x,c.max.y,c.min.z),new S(c.max.x,c.min.y,c.max.z),new S(c.max.x,c.min.y,c.min.z)],C=o.current.camPos||l.position,R=o.current.target||(m==null?void 0:m.target),P=o.current.camUp||l.up,A=R?new $().lookAt(C,R,P).setPosition(C).invert():l.matrixWorldInverse;for(const L of j)L.applyMatrix4(A),i=Math.max(i,Math.abs(L.y)),h=Math.max(h,Math.abs(L.x));i*=2,h*=2;const z=(l.top-l.bottom)/i,N=(l.right-l.left)/h;return o.current.camZoom=Math.min(z,N)/a,v.current=T.START,d.current=0,D.current&&D.current(this.getSize()),this},clip(){const{distance:i}=f();return l.near=i/100,l.far=i*100,l.updateProjectionMatrix(),m&&(m.maxDistance=i*10,m.update()),E(),this}}},[c,l,m,a,E]);e.useLayoutEffect(()=>{if(m){const f=()=>{if(m&&o.current.target&&v.current!==T.NONE){const i=new S().setFromMatrixColumn(l.matrix,2),h=w.current.camPos.distanceTo(m.target),j=(o.current.camPos||w.current.camPos).distanceTo(o.current.target),C=(1-d.current)*h+d.current*j;m.target.copy(l.position).addScaledVector(i,-C),m.update()}v.current=T.NONE};return m.addEventListener("start",f),()=>m.removeEventListener("start",f)}},[m]);const y=e.useRef(0);return e.useLayoutEffect(()=>{(s||y.current++===0)&&(M.refresh(),u&&M.reset().fit(),p&&M.clip())},[U,p,u,s,l,m]),q((f,i)=>{if(v.current===T.START)v.current=T.ACTIVE,E();else if(v.current===T.ACTIVE){if(d.current+=i/n,d.current>=1)o.current.camPos&&l.position.copy(o.current.camPos),o.current.camRot&&l.quaternion.copy(o.current.camRot),o.current.camUp&&l.up.copy(o.current.camUp),o.current.camZoom&&I(l)&&(l.zoom=o.current.camZoom),l.updateMatrixWorld(),l.updateProjectionMatrix(),m&&o.current.target&&(m.target.copy(o.current.target),m.update()),v.current=T.NONE;else{const h=b(d.current);o.current.camPos&&l.position.lerpVectors(w.current.camPos,o.current.camPos,h),o.current.camRot&&l.quaternion.slerpQuaternions(w.current.camRot,o.current.camRot,h),o.current.camUp&&l.up.set(0,1,0).applyQuaternion(l.quaternion),o.current.camZoom&&I(l)&&(l.zoom=(1-h)*w.current.camZoom+h*o.current.camZoom),l.updateMatrixWorld(),l.updateProjectionMatrix()}E()}}),e.createElement("group",{ref:x},e.createElement(se.Provider,{value:M},r))}function Ne(){return e.useContext(se)}const Te=e.forwardRef(({scale:r=10,frames:n=1/0,opacity:a=1,width:s=1,height:u=1,blur:p=1,near:b=0,far:g=10,resolution:x=512,smooth:l=!0,color:U="#000000",depthWrite:E=!1,renderOrder:m,...D},w)=>{const o=e.useRef(null),v=_(N=>N.scene),d=_(N=>N.gl),c=e.useRef(null);s=s*(Array.isArray(r)?r[0]:r||1),u=u*(Array.isArray(r)?r[1]:r||1);const[M,y,f,i,h,j,C]=e.useMemo(()=>{const N=new G(x,x),L=new G(x,x);L.texture.generateMipmaps=N.texture.generateMipmaps=!1;const B=new fe(s,u).rotateX(Math.PI/2),W=new re(B),O=new he;O.depthTest=O.depthWrite=!1,O.onBeforeCompile=k=>{k.uniforms={...k.uniforms,ucolor:{value:new Q(U)}},k.fragmentShader=k.fragmentShader.replace("void main() {",`uniform vec3 ucolor;
           void main() {
          `),k.fragmentShader=k.fragmentShader.replace("vec4( vec3( 1.0 - fragCoordZ ), opacity );","vec4( ucolor * fragCoordZ * 2.0, ( 1.0 - fragCoordZ ) * 1.0 );")};const J=new K(je),Y=new K(Se);return Y.depthTest=J.depthTest=!1,[N,B,O,W,J,Y,L]},[x,s,u,r,U]),R=N=>{i.visible=!0,i.material=h,h.uniforms.tDiffuse.value=M.texture,h.uniforms.h.value=N*1/256,d.setRenderTarget(C),d.render(i,c.current),i.material=j,j.uniforms.tDiffuse.value=C.texture,j.uniforms.v.value=N*1/256,d.setRenderTarget(M),d.render(i,c.current),i.visible=!1};let P=0,A,z;return q(()=>{c.current&&(n===1/0||P<n)&&(P++,A=v.background,z=v.overrideMaterial,o.current.visible=!1,v.background=null,v.overrideMaterial=f,d.setRenderTarget(M),d.render(v,c.current),R(p),l&&R(p*.4),d.setRenderTarget(null),o.current.visible=!0,v.overrideMaterial=z,v.background=A)}),e.useImperativeHandle(w,()=>o.current,[]),e.createElement("group",F({"rotation-x":Math.PI/2},D,{ref:o}),e.createElement("mesh",{renderOrder:m,geometry:y,scale:[1,-1,1],rotation:[-Math.PI/2,0,0]},e.createElement("meshBasicMaterial",{transparent:!0,map:M.texture,opacity:a,depthWrite:E})),e.createElement("orthographicCamera",{ref:c,args:[-s/2,s/2,u/2,-u/2,b,g]}))});function Pe(r){return r.isLight}function Ae(r){return!!r.geometry}const oe=e.createContext(null),Le=te({color:new Q,blend:2,alphaTest:.75,opacity:0,map:null},`varying vec2 vUv;
   void main() {
     gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.);
     vUv = uv;
   }`,`varying vec2 vUv;
   uniform sampler2D map;
   uniform vec3 color;
   uniform float opacity;
   uniform float alphaTest;
   uniform float blend;
   void main() {
     vec4 sampledDiffuseColor = texture2D(map, vUv);
     gl_FragColor = vec4(color * sampledDiffuseColor.r * blend, max(0.0, (1.0 - (sampledDiffuseColor.r + sampledDiffuseColor.g + sampledDiffuseColor.b) / alphaTest)) * opacity);
     #include <tonemapping_fragment>
     #include <${ne>=154?"colorspace_fragment":"encodings_fragment"}>
   }`),_e=e.forwardRef(({children:r,temporal:n,frames:a=40,limit:s=1/0,blend:u=20,scale:p=10,opacity:b=1,alphaTest:g=.75,color:x="black",colorBlend:l=2,resolution:U=1024,toneMapped:E=!0,...m},D)=>{ve({SoftShadowMaterial:Le});const w=_(i=>i.gl),o=_(i=>i.scene),v=_(i=>i.camera),d=_(i=>i.invalidate),c=e.useRef(null),M=e.useRef(null),[y]=e.useState(()=>new Fe(w,o,U));e.useLayoutEffect(()=>{y.configure(c.current)},[]);const f=e.useMemo(()=>({lights:new Map,temporal:!!n,frames:Math.max(2,a),blend:Math.max(2,a===1/0?u:a),count:0,getMesh:()=>c.current,reset:()=>{y.clear();const i=c.current.material;i.opacity=0,i.alphaTest=0,f.count=0},update:(i=1)=>{const h=c.current.material;f.temporal?(h.opacity=Math.min(b,h.opacity+b/f.blend),h.alphaTest=Math.min(g,h.alphaTest+g/f.blend)):(h.opacity=b,h.alphaTest=g),M.current.visible=!0,y.prepare();for(let j=0;j<i;j++)f.lights.forEach(C=>C.update()),y.update(v,f.blend);M.current.visible=!1,y.finish()}}),[y,v,o,n,a,u,b,g]);return e.useLayoutEffect(()=>{f.reset(),!f.temporal&&f.frames!==1/0&&f.update(f.blend)}),e.useImperativeHandle(D,()=>f,[f]),q(()=>{(f.temporal||f.frames===1/0)&&f.count<f.frames&&f.count<s&&(d(),f.update(),f.count++)}),e.createElement("group",m,e.createElement("group",{traverse:()=>null,ref:M},e.createElement(oe.Provider,{value:f},r)),e.createElement("mesh",{receiveShadow:!0,ref:c,scale:p,rotation:[-Math.PI/2,0,0]},e.createElement("planeGeometry",null),e.createElement("softShadowMaterial",{transparent:!0,depthWrite:!1,toneMapped:E,color:x,blend:l,map:y.progressiveLightMap2.texture})))}),ze=e.forwardRef(({castShadow:r=!0,bias:n=.001,mapSize:a=512,size:s=5,near:u=.5,far:p=500,frames:b=1,position:g=[0,0,0],radius:x=1,amount:l=8,intensity:U=ne>=155?Math.PI:1,ambient:E=.5,...m},D)=>{const w=e.useRef(null),o=new S(...g).length(),v=e.useContext(oe),d=e.useCallback(()=>{let M;if(w.current)for(let y=0;y<w.current.children.length;y++)if(M=w.current.children[y],Math.random()>E)M.position.set(g[0]+Z.randFloatSpread(x),g[1]+Z.randFloatSpread(x),g[2]+Z.randFloatSpread(x));else{let f=Math.acos(2*Math.random()-1)-Math.PI/2,i=2*Math.PI*Math.random();M.position.set(Math.cos(f)*Math.cos(i)*o,Math.abs(Math.cos(f)*Math.sin(i)*o),Math.sin(f)*o)}},[x,E,o,...g]),c=e.useMemo(()=>({update:d}),[d]);return e.useImperativeHandle(D,()=>c,[c]),e.useLayoutEffect(()=>{var M;const y=w.current;return v&&((M=v.lights)==null||M.set(y.uuid,c)),()=>{var f;return void(v==null||(f=v.lights)==null?void 0:f.delete(y.uuid))}},[v,c]),e.createElement("group",F({ref:w},m),Array.from({length:l},(M,y)=>e.createElement("directionalLight",{key:y,castShadow:r,"shadow-bias":n,"shadow-mapSize":[a,a],intensity:U/l},e.createElement("orthographicCamera",{attach:"shadow-camera",args:[-s,s,s,-s,u,p]}))))});class Fe{constructor(n,a,s=1024){this.renderer=n,this.res=s,this.scene=a,this.buffer1Active=!1,this.lights=[],this.meshes=[],this.object=null,this.clearColor=new Q,this.clearAlpha=0;const u={type:ge,magFilter:X,minFilter:X};this.progressiveLightMap1=new G(this.res,this.res,u),this.progressiveLightMap2=new G(this.res,this.res,u),this.discardMat=new De,this.targetMat=new pe({fog:!1}),this.previousShadowMap={value:this.progressiveLightMap1.texture},this.averagingWindow={value:100},this.targetMat.onBeforeCompile=p=>{p.vertexShader=`varying vec2 vUv;
`+p.vertexShader.slice(0,-1)+"vUv = uv; gl_Position = vec4((uv - 0.5) * 2.0, 1.0, 1.0); }";const b=p.fragmentShader.indexOf("void main() {");p.fragmentShader=`varying vec2 vUv;
`+p.fragmentShader.slice(0,b)+`uniform sampler2D previousShadowMap;
	uniform float averagingWindow;
`+p.fragmentShader.slice(b-1,-1)+`
vec3 texelOld = texture2D(previousShadowMap, vUv).rgb;
        gl_FragColor.rgb = mix(texelOld, gl_FragColor.rgb, 1.0/ averagingWindow);
      }`,p.uniforms.previousShadowMap=this.previousShadowMap,p.uniforms.averagingWindow=this.averagingWindow}}clear(){this.renderer.getClearColor(this.clearColor),this.clearAlpha=this.renderer.getClearAlpha(),this.renderer.setClearColor("black",1),this.renderer.setRenderTarget(this.progressiveLightMap1),this.renderer.clear(),this.renderer.setRenderTarget(this.progressiveLightMap2),this.renderer.clear(),this.renderer.setRenderTarget(null),this.renderer.setClearColor(this.clearColor,this.clearAlpha),this.lights=[],this.meshes=[],this.scene.traverse(n=>{Ae(n)?this.meshes.push({object:n,material:n.material}):Pe(n)&&this.lights.push({object:n,intensity:n.intensity})})}prepare(){this.lights.forEach(n=>n.object.intensity=0),this.meshes.forEach(n=>n.object.material=this.discardMat)}finish(){this.lights.forEach(n=>n.object.intensity=n.intensity),this.meshes.forEach(n=>n.object.material=n.material)}configure(n){this.object=n}update(n,a=100){if(!this.object)return;this.averagingWindow.value=a,this.object.material=this.targetMat;const s=this.buffer1Active?this.progressiveLightMap1:this.progressiveLightMap2,u=this.buffer1Active?this.progressiveLightMap2:this.progressiveLightMap1,p=this.scene.background;this.scene.background=null,this.renderer.setRenderTarget(s),this.previousShadowMap.value=u.texture,this.buffer1Active=!this.buffer1Active,this.renderer.render(this.scene,n),this.renderer.setRenderTarget(null),this.scene.background=p}}const ke={rembrandt:{main:[1,2,1],fill:[-2,-.5,-2]},portrait:{main:[-1,2,.5],fill:[-1,.5,-1.5]},upfront:{main:[0,2,1],fill:[-1,.5,-1.5]},soft:{main:[-2,4,4],fill:[-1,.5,-1.5]}};function Ie({radius:r,adjustCamera:n}){const a=Ne();return e.useEffect(()=>{n&&a.refresh().clip().fit()},[r,n]),null}function Be({children:r,center:n,adjustCamera:a=!0,intensity:s=.5,shadows:u="contact",environment:p="city",preset:b="rembrandt",...g}){var x,l,U,E,m,D,w,o;const v=typeof b=="string"?ke[b]:b,[{radius:d,height:c},M]=e.useState({radius:0,width:0,height:0,depth:0}),y=(x=u==null?void 0:u.bias)!==null&&x!==void 0?x:-1e-4,f=(l=u==null?void 0:u.normalBias)!==null&&l!==void 0?l:0,i=(U=u==null?void 0:u.size)!==null&&U!==void 0?U:1024,h=(E=u==null?void 0:u.offset)!==null&&E!==void 0?E:0,j=u==="contact"||(u==null?void 0:u.type)==="contact",C=u==="accumulative"||(u==null?void 0:u.type)==="accumulative",R={...typeof u=="object"?u:{}},P=p?typeof p=="string"?{preset:p}:p:null,A=e.useCallback(z=>{const{width:N,height:L,depth:B,boundingSphere:W}=z;M({radius:W.radius,width:N,height:L,depth:B}),n!=null&&n.onCentered&&n.onCentered(z)},[]);return e.createElement(e.Fragment,null,e.createElement("ambientLight",{intensity:s/3}),e.createElement("spotLight",{penumbra:1,position:[v.main[0]*d,v.main[1]*d,v.main[2]*d],intensity:s*2,castShadow:!!u,"shadow-bias":y,"shadow-normalBias":f,"shadow-mapSize":i}),e.createElement("pointLight",{position:[v.fill[0]*d,v.fill[1]*d,v.fill[2]*d],intensity:s}),e.createElement(Re,F({fit:!!a,clip:!!a,margin:Number(a),observe:!0},g),e.createElement(Ie,{radius:d,adjustCamera:a}),e.createElement(Ee,F({},n,{position:[0,h/2,0],onCentered:A}),r)),e.createElement("group",{position:[0,-c/2-h/2,0]},j&&e.createElement(Te,F({scale:d*4,far:d,blur:2},R)),C&&e.createElement(_e,F({temporal:!0,frames:100,alphaTest:.9,toneMapped:!0,scale:d*4},R),e.createElement(ze,{amount:(m=R.amount)!==null&&m!==void 0?m:8,radius:(D=R.radius)!==null&&D!==void 0?D:d,ambient:(w=R.ambient)!==null&&w!==void 0?w:.5,intensity:(o=R.intensity)!==null&&o!==void 0?o:1,position:[v.main[0]*d,v.main[1]*d,v.main[2]*d],size:d*4,bias:-y,mapSize:i}))),p&&e.createElement(Me,P))}const ie="https://api.meshy.ai",le="msy_Zeid206soTeJFwk9HaBPUqWmzMc8M2ZLQHL5",ce={Authorization:`Bearer ${le}`,"Content-Type":"application/json"};async function Oe(r,n,a,s="quad",u,p){const b=await fetch(`${ie}/v2/text-to-3d`,{method:"POST",headers:ce,body:JSON.stringify({mode:"preview",prompt:r,art_style:n,negative_prompt:a,topology:s,target_polycount:u,seed:p,ai_model:"meshy-4"})});if(!b.ok){const x=await b.json();throw new Error(x.message||"Failed to create preview task")}return(await b.json()).result}async function Ge(r){const n=await fetch(`${ie}/v2/text-to-3d/${r}`,{headers:ce});if(!n.ok){const a=await n.json();throw new Error(a.message||"Failed to get task status")}return n.json()}async function We(r){try{const n=await fetch(r,{headers:{Authorization:`Bearer ${le}`,Accept:"model/gltf-binary,model/gltf+json,*/*"}});if(!n.ok)throw new Error(`Failed to fetch model: ${n.statusText}`);const a=await n.blob();return URL.createObjectURL(a)}catch(n){throw console.error("Error fetching model:",n),n}}function ee(){return t.jsxs("mesh",{children:[t.jsx("sphereGeometry",{args:[1,32,32]}),t.jsx("meshStandardMaterial",{color:"#2a2a2f"})]})}function He({url:r}){const n=e.useRef(),a=xe(async()=>{try{const s=await We(r),u=new we;return await new Promise((b,g)=>{u.load(s,x=>{URL.revokeObjectURL(s),b(x)},void 0,x=>{URL.revokeObjectURL(s),g(x)})})}catch(s){throw console.error("Error loading model:",s),s}},[r]);return e.useEffect(()=>{if(a!=null&&a.scene){const s=new V().setFromObject(a.scene),u=s.getCenter(new S);a.scene.position.sub(u);const p=s.getSize(new S),g=2/Math.max(p.x,p.y,p.z);a.scene.scale.multiplyScalar(g)}},[a]),e.useEffect(()=>()=>{n.current&&n.current.traverse(s=>{s instanceof re&&(s.geometry.dispose(),s.material&&(Array.isArray(s.material)?s.material.forEach(u=>u.dispose()):s.material.dispose()))})},[]),t.jsx("primitive",{ref:n,object:a.scene})}const $e=({modelUrl:r})=>t.jsx("div",{className:"w-full h-full",children:t.jsx(ae,{FallbackComponent:({error:n})=>t.jsx("div",{className:"w-full h-full flex items-center justify-center text-red-400",children:t.jsxs("p",{children:["Error loading model: ",n.message]})}),children:t.jsxs(ye,{shadows:!0,camera:{position:[0,0,4],fov:50},className:"w-full h-full",children:[t.jsx("color",{attach:"background",args:["#121214"]}),t.jsx("gridHelper",{args:[20,20,"#242429","#1a1a1f"],position:[0,-1,0]}),t.jsx(Be,{environment:"city",intensity:.5,adjustCamera:1.5,shadows:!1,preset:"rembrandt",children:t.jsx(e.Suspense,{fallback:t.jsx(ee,{}),children:r?t.jsx(He,{url:r}):t.jsx(ee,{})})}),t.jsx(be,{makeDefault:!0,minDistance:2,maxDistance:10,enablePan:!1,autoRotate:!r,autoRotateSpeed:1})]})})}),Ze=({checked:r,onCheckedChange:n,disabled:a})=>t.jsx("button",{type:"button",role:"switch","aria-checked":r,disabled:a,onClick:()=>n(!r),className:`
        relative inline-flex h-6 w-11 items-center rounded-full
        transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2
        ${r?"bg-blue-500":"bg-[#242429]"}
        ${a?"opacity-50 cursor-not-allowed":"cursor-pointer"}
      `,children:t.jsx("span",{className:`
          inline-block h-4 w-4 transform rounded-full bg-white transition-transform
          ${r?"translate-x-6":"translate-x-1"}
        `})}),Ve=({onGenerate:r,disabled:n})=>{const[a,s]=e.useState({prompt:"",symmetry:"auto",useFixedSeed:!1,targetPolycount:"adaptive",topology:"quad"}),u=g=>{g.preventDefault(),r(a)},p=a.prompt.length,b=500;return t.jsxs("form",{onSubmit:u,className:"bg-[#121214] rounded-lg border border-[#242429] p-4 space-y-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-2",children:"Prompt"}),t.jsx("textarea",{value:a.prompt,onChange:g=>s({...a,prompt:g.target.value}),className:"w-full px-3 py-2 bg-[#0a0a0b] border border-[#242429] rounded-md text-white resize-none",rows:4,maxLength:b,placeholder:"Describe the object you want to generate. You can use your native language.",disabled:n}),t.jsxs("div",{className:"mt-1 text-xs text-gray-400 text-right",children:[p,"/",b]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-2",children:"Symmetry"}),t.jsxs("select",{value:a.symmetry,onChange:g=>s({...a,symmetry:g.target.value}),className:"w-full px-3 py-2 bg-[#0a0a0b] border border-[#242429] rounded-md text-white",disabled:n,children:[t.jsx("option",{value:"off",children:"Off"}),t.jsx("option",{value:"auto",children:"Auto"}),t.jsx("option",{value:"on",children:"On"})]})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("label",{className:"text-sm font-medium",children:"Use Fixed Seed"}),t.jsx(Ze,{checked:a.useFixedSeed,onCheckedChange:g=>s({...a,useFixedSeed:g}),disabled:n})]}),a.useFixedSeed&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-2",children:"Seed"}),t.jsx("input",{type:"number",value:a.seed||"",onChange:g=>s({...a,seed:parseInt(g.target.value)||0}),className:"w-full px-3 py-2 bg-[#0a0a0b] border border-[#242429] rounded-md text-white",disabled:n})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-2",children:"Target Polycount"}),t.jsxs("select",{value:a.targetPolycount,onChange:g=>s({...a,targetPolycount:g.target.value}),className:"w-full px-3 py-2 bg-[#0a0a0b] border border-[#242429] rounded-md text-white",disabled:n,children:[t.jsx("option",{value:"adaptive",children:"Adaptive"}),t.jsx("option",{value:"low",children:"Low"}),t.jsx("option",{value:"medium",children:"Medium"}),t.jsx("option",{value:"high",children:"High"}),t.jsx("option",{value:"ultra",children:"Ultra"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-2",children:"Topology"}),t.jsxs("select",{value:a.topology,onChange:g=>s({...a,topology:g.target.value}),className:"w-full px-3 py-2 bg-[#0a0a0b] border border-[#242429] rounded-md text-white",disabled:n,children:[t.jsx("option",{value:"quad",children:"Quad"}),t.jsx("option",{value:"triangle",children:"Triangle"})]})]}),t.jsx("button",{type:"submit",disabled:n||!a.prompt.trim(),className:"w-full px-4 py-2 bg-gradient-to-r from-green-500 to-pink-500 text-white rounded-md font-medium disabled:opacity-50 disabled:cursor-not-allowed hover:from-green-600 hover:to-pink-600 transition-colors",children:"Generate"})]})},qe=({task:r,isSelected:n,onClick:a})=>{const s=r.status==="PENDING"||r.status==="IN_PROGRESS",u=r.status==="FAILED",p=r.status==="SUCCEEDED";return t.jsx("button",{onClick:a,disabled:!p,className:`
        w-full aspect-square rounded-lg overflow-hidden relative transition-all
        ${n?"ring-2 ring-blue-500":p?"hover:ring-2 hover:ring-[#242429]":""}
        ${s?"bg-[#121214]":"bg-[#0a0a0b]"}
        ${u?"bg-red-900/20":""}
        ${!p&&!s?"cursor-not-allowed opacity-50":""}
      `,children:s?t.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[t.jsx(ue,{className:"w-6 h-6 text-blue-500 animate-spin mb-2"}),t.jsxs("span",{className:"text-sm text-gray-400",children:[r.progress,"%"]})]}):r.thumbnail_url&&r.status==="SUCCEEDED"?t.jsx("img",{src:r.thumbnail_url,alt:r.prompt,className:"w-full h-full object-cover",loading:"lazy"}):t.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-red-400",children:u?"Failed":"Unavailable"})})},Qe=({tasks:r,selectedTaskId:n,onSelectTask:a})=>t.jsxs("div",{className:"w-64 h-full bg-[#121214] border-r border-[#242429] p-4 overflow-y-auto",children:[t.jsx("h2",{className:"text-sm font-medium text-gray-400 mb-4",children:"History"}),t.jsx("div",{className:"grid grid-cols-2 gap-2",children:r.map(s=>t.jsx(qe,{task:s,isSelected:s.id===n,onClick:()=>{s.status==="SUCCEEDED"&&a(s)}},s.id))})]}),Je=({progress:r})=>t.jsxs("div",{className:"bg-[#121214] rounded-lg border border-[#242429] p-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:"text-sm font-medium",children:"Generating..."}),t.jsxs("span",{className:"text-sm text-gray-400",children:[r,"%"]})]}),t.jsx("div",{className:"w-full bg-[#0a0a0b] rounded-full h-2",children:t.jsx("div",{className:"bg-blue-500 h-2 rounded-full transition-all duration-300",style:{width:`${r}%`}})})]}),tt=()=>{const[r,n]=e.useState([]),[a,s]=e.useState(null),[u,p]=e.useState(!1),[b,g]=e.useState(null),x=r.find(m=>m.id===a),l=(x==null?void 0:x.status)==="SUCCEEDED"?x.model_urls.glb:null,U=m=>m==="adaptive"?void 0:{low:1e4,medium:3e4,high:5e4,ultra:1e5}[m],E=async m=>{var D;try{p(!0),g(null),s(null);const w=await Oe(m.prompt,"realistic",void 0,m.topology,U(m.targetPolycount),m.useFixedSeed?m.seed:void 0),o={id:w,prompt:m.prompt,status:"PENDING",progress:0,model_urls:{glb:"",fbx:"",usdz:"",obj:"",mtl:""},thumbnail_url:"",video_url:"",art_style:"realistic",negative_prompt:"",started_at:Date.now(),created_at:Date.now(),finished_at:0,texture_urls:[]};n(d=>[o,...d]);let v=o;for(;v.status==="PENDING"||v.status==="IN_PROGRESS";)await new Promise(d=>setTimeout(d,1e3)),v=await Ge(w),n(d=>d.map(c=>c.id===w?v:c));if(v.status==="FAILED")throw new Error(((D=v.task_error)==null?void 0:D.message)||"Generation failed")}catch(w){g(w instanceof Error?w.message:"An error occurred")}finally{p(!1)}};return t.jsx("div",{className:"h-[calc(100vh-44px)] flex flex-col",children:t.jsx("main",{className:"flex-1 min-h-0 p-4",children:t.jsxs("div",{className:"flex gap-4 h-full",children:[t.jsx(Qe,{tasks:r,selectedTaskId:a,onSelectTask:m=>{m.status==="SUCCEEDED"&&s(m.id)}}),t.jsx("div",{className:"flex-1 h-full bg-[#121214] rounded-lg border border-[#242429] overflow-hidden",children:t.jsx(ae,{FallbackComponent:({error:m})=>t.jsx("div",{className:"w-full h-full flex items-center justify-center text-red-400",children:t.jsxs("p",{children:["Error loading model: ",m.message]})}),children:t.jsx(e.Suspense,{fallback:t.jsx(me,{}),children:t.jsx($e,{modelUrl:l})})})}),t.jsxs("div",{className:"w-80 h-full space-y-4",children:[t.jsx(Ve,{onGenerate:E,disabled:u}),b&&t.jsx("div",{className:"bg-red-900/20 border border-red-900 rounded-lg p-4 text-red-400",children:b}),u&&x&&t.jsx(Je,{progress:x.progress})]})]})})})};export{tt as default};

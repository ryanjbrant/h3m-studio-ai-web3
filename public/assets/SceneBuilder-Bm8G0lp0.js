import{c as at,r as j,a as lt,j as E,L as Et,b as Pt}from"./index-Ca5JFDiE.js";import{aa as pe,ab as It,a as v,ac as ie,M as z,X as ct,l as je,ad as xe,ae as te,af as me,ag as ue,F as H,d as S,ah as F,ai as ge,c as ye,aj as Pe,ak as Mt,Q as X,f as W,b as ce,_ as Tt,u as Lt,Z as De,Y as ht,al as _e,am as Ge,an as Ie,ao as Fe,ap as He,aq as ke,ar as Re,as as At,at as Ft,au as jt,av as Ne,r as We,T as Oe,j as Dt,a1 as Me,a5 as Ct,aw as qe,ax as Ce,w as Rt,ay as kt,az as Ke,i as G,aA as Ot,aB as Vt,aC as Xt,aD as zt,aE as Bt,aF as Qt,aG as _t,V as Ut,aH as Yt,aI as Zt,aJ as Gt,aK as $e,aL as Ht,$ as Nt,B as Wt,aM as qt,aN as Kt,aO as $t,C as Jt,O as en}from"./OrbitControls-DP0yiWgp.js";import{U as tn,S as nn,G as sn}from"./Grid-Nl3wDxcy.js";import{G as Je,E as rn}from"./ErrorBoundary-BcqLfEQu.js";import{L as on,T as an}from"./target-D__55dyN.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ln=at("Disc",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cn=at("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);var hn=Object.defineProperty,pn=(l,e,t)=>e in l?hn(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t,d=(l,e,t)=>(pn(l,typeof e!="symbol"?e+"":e,t),t);let un=class extends pe{constructor(e,t){super(),d(this,"isTransformControls",!0),d(this,"visible",!1),d(this,"domElement"),d(this,"raycaster",new It),d(this,"gizmo"),d(this,"plane"),d(this,"tempVector",new v),d(this,"tempVector2",new v),d(this,"tempQuaternion",new X),d(this,"unit",{X:new v(1,0,0),Y:new v(0,1,0),Z:new v(0,0,1)}),d(this,"pointStart",new v),d(this,"pointEnd",new v),d(this,"offset",new v),d(this,"rotationAxis",new v),d(this,"startNorm",new v),d(this,"endNorm",new v),d(this,"rotationAngle",0),d(this,"cameraPosition",new v),d(this,"cameraQuaternion",new X),d(this,"cameraScale",new v),d(this,"parentPosition",new v),d(this,"parentQuaternion",new X),d(this,"parentQuaternionInv",new X),d(this,"parentScale",new v),d(this,"worldPositionStart",new v),d(this,"worldQuaternionStart",new X),d(this,"worldScaleStart",new v),d(this,"worldPosition",new v),d(this,"worldQuaternion",new X),d(this,"worldQuaternionInv",new X),d(this,"worldScale",new v),d(this,"eye",new v),d(this,"positionStart",new v),d(this,"quaternionStart",new X),d(this,"scaleStart",new v),d(this,"camera"),d(this,"object"),d(this,"enabled",!0),d(this,"axis",null),d(this,"mode","translate"),d(this,"translationSnap",null),d(this,"rotationSnap",null),d(this,"scaleSnap",null),d(this,"space","world"),d(this,"size",1),d(this,"dragging",!1),d(this,"showX",!0),d(this,"showY",!0),d(this,"showZ",!0),d(this,"changeEvent",{type:"change"}),d(this,"mouseDownEvent",{type:"mouseDown",mode:this.mode}),d(this,"mouseUpEvent",{type:"mouseUp",mode:this.mode}),d(this,"objectChangeEvent",{type:"objectChange"}),d(this,"intersectObjectWithRay",(n,s,o)=>{const r=s.intersectObject(n,!0);for(let a=0;a<r.length;a++)if(r[a].object.visible||o)return r[a];return!1}),d(this,"attach",n=>(this.object=n,this.visible=!0,this)),d(this,"detach",()=>(this.object=void 0,this.visible=!1,this.axis=null,this)),d(this,"reset",()=>this.enabled?(this.dragging&&this.object!==void 0&&(this.object.position.copy(this.positionStart),this.object.quaternion.copy(this.quaternionStart),this.object.scale.copy(this.scaleStart),this.dispatchEvent(this.changeEvent),this.dispatchEvent(this.objectChangeEvent),this.pointStart.copy(this.pointEnd)),this):this),d(this,"updateMatrixWorld",()=>{this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this.parentPosition,this.parentQuaternion,this.parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this.worldScale),this.parentQuaternionInv.copy(this.parentQuaternion).invert(),this.worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this.cameraScale),this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld()}),d(this,"pointerHover",n=>{if(this.object===void 0||this.dragging===!0)return;this.raycaster.setFromCamera(n,this.camera);const s=this.intersectObjectWithRay(this.gizmo.picker[this.mode],this.raycaster);s?this.axis=s.object.name:this.axis=null}),d(this,"pointerDown",n=>{if(!(this.object===void 0||this.dragging===!0||n.button!==0)&&this.axis!==null){this.raycaster.setFromCamera(n,this.camera);const s=this.intersectObjectWithRay(this.plane,this.raycaster,!0);if(s){let o=this.space;if(this.mode==="scale"?o="local":(this.axis==="E"||this.axis==="XYZE"||this.axis==="XYZ")&&(o="world"),o==="local"&&this.mode==="rotate"){const r=this.rotationSnap;this.axis==="X"&&r&&(this.object.rotation.x=Math.round(this.object.rotation.x/r)*r),this.axis==="Y"&&r&&(this.object.rotation.y=Math.round(this.object.rotation.y/r)*r),this.axis==="Z"&&r&&(this.object.rotation.z=Math.round(this.object.rotation.z/r)*r)}this.object.updateMatrixWorld(),this.object.parent&&this.object.parent.updateMatrixWorld(),this.positionStart.copy(this.object.position),this.quaternionStart.copy(this.object.quaternion),this.scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this.worldScaleStart),this.pointStart.copy(s.point).sub(this.worldPositionStart)}this.dragging=!0,this.mouseDownEvent.mode=this.mode,this.dispatchEvent(this.mouseDownEvent)}}),d(this,"pointerMove",n=>{const s=this.axis,o=this.mode,r=this.object;let a=this.space;if(o==="scale"?a="local":(s==="E"||s==="XYZE"||s==="XYZ")&&(a="world"),r===void 0||s===null||this.dragging===!1||n.button!==-1)return;this.raycaster.setFromCamera(n,this.camera);const p=this.intersectObjectWithRay(this.plane,this.raycaster,!0);if(p){if(this.pointEnd.copy(p.point).sub(this.worldPositionStart),o==="translate")this.offset.copy(this.pointEnd).sub(this.pointStart),a==="local"&&s!=="XYZ"&&this.offset.applyQuaternion(this.worldQuaternionInv),s.indexOf("X")===-1&&(this.offset.x=0),s.indexOf("Y")===-1&&(this.offset.y=0),s.indexOf("Z")===-1&&(this.offset.z=0),a==="local"&&s!=="XYZ"?this.offset.applyQuaternion(this.quaternionStart).divide(this.parentScale):this.offset.applyQuaternion(this.parentQuaternionInv).divide(this.parentScale),r.position.copy(this.offset).add(this.positionStart),this.translationSnap&&(a==="local"&&(r.position.applyQuaternion(this.tempQuaternion.copy(this.quaternionStart).invert()),s.search("X")!==-1&&(r.position.x=Math.round(r.position.x/this.translationSnap)*this.translationSnap),s.search("Y")!==-1&&(r.position.y=Math.round(r.position.y/this.translationSnap)*this.translationSnap),s.search("Z")!==-1&&(r.position.z=Math.round(r.position.z/this.translationSnap)*this.translationSnap),r.position.applyQuaternion(this.quaternionStart)),a==="world"&&(r.parent&&r.position.add(this.tempVector.setFromMatrixPosition(r.parent.matrixWorld)),s.search("X")!==-1&&(r.position.x=Math.round(r.position.x/this.translationSnap)*this.translationSnap),s.search("Y")!==-1&&(r.position.y=Math.round(r.position.y/this.translationSnap)*this.translationSnap),s.search("Z")!==-1&&(r.position.z=Math.round(r.position.z/this.translationSnap)*this.translationSnap),r.parent&&r.position.sub(this.tempVector.setFromMatrixPosition(r.parent.matrixWorld))));else if(o==="scale"){if(s.search("XYZ")!==-1){let h=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(h*=-1),this.tempVector2.set(h,h,h)}else this.tempVector.copy(this.pointStart),this.tempVector2.copy(this.pointEnd),this.tempVector.applyQuaternion(this.worldQuaternionInv),this.tempVector2.applyQuaternion(this.worldQuaternionInv),this.tempVector2.divide(this.tempVector),s.search("X")===-1&&(this.tempVector2.x=1),s.search("Y")===-1&&(this.tempVector2.y=1),s.search("Z")===-1&&(this.tempVector2.z=1);r.scale.copy(this.scaleStart).multiply(this.tempVector2),this.scaleSnap&&this.object&&(s.search("X")!==-1&&(this.object.scale.x=Math.round(r.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),s.search("Y")!==-1&&(r.scale.y=Math.round(r.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),s.search("Z")!==-1&&(r.scale.z=Math.round(r.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(o==="rotate"){this.offset.copy(this.pointEnd).sub(this.pointStart);const h=20/this.worldPosition.distanceTo(this.tempVector.setFromMatrixPosition(this.camera.matrixWorld));s==="E"?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this.startNorm.copy(this.pointStart).normalize(),this.endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this.endNorm.cross(this.startNorm).dot(this.eye)<0?1:-1):s==="XYZE"?(this.rotationAxis.copy(this.offset).cross(this.eye).normalize(),this.rotationAngle=this.offset.dot(this.tempVector.copy(this.rotationAxis).cross(this.eye))*h):(s==="X"||s==="Y"||s==="Z")&&(this.rotationAxis.copy(this.unit[s]),this.tempVector.copy(this.unit[s]),a==="local"&&this.tempVector.applyQuaternion(this.worldQuaternion),this.rotationAngle=this.offset.dot(this.tempVector.cross(this.eye).normalize())*h),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),a==="local"&&s!=="E"&&s!=="XYZE"?(r.quaternion.copy(this.quaternionStart),r.quaternion.multiply(this.tempQuaternion.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this.parentQuaternionInv),r.quaternion.copy(this.tempQuaternion.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),r.quaternion.multiply(this.quaternionStart).normalize())}this.dispatchEvent(this.changeEvent),this.dispatchEvent(this.objectChangeEvent)}}),d(this,"pointerUp",n=>{n.button===0&&(this.dragging&&this.axis!==null&&(this.mouseUpEvent.mode=this.mode,this.dispatchEvent(this.mouseUpEvent)),this.dragging=!1,this.axis=null)}),d(this,"getPointer",n=>{var s;if(this.domElement&&((s=this.domElement.ownerDocument)!=null&&s.pointerLockElement))return{x:0,y:0,button:n.button};{const o=n.changedTouches?n.changedTouches[0]:n,r=this.domElement.getBoundingClientRect();return{x:(o.clientX-r.left)/r.width*2-1,y:-(o.clientY-r.top)/r.height*2+1,button:n.button}}}),d(this,"onPointerHover",n=>{if(this.enabled)switch(n.pointerType){case"mouse":case"pen":this.pointerHover(this.getPointer(n));break}}),d(this,"onPointerDown",n=>{!this.enabled||!this.domElement||(this.domElement.style.touchAction="none",this.domElement.ownerDocument.addEventListener("pointermove",this.onPointerMove),this.pointerHover(this.getPointer(n)),this.pointerDown(this.getPointer(n)))}),d(this,"onPointerMove",n=>{this.enabled&&this.pointerMove(this.getPointer(n))}),d(this,"onPointerUp",n=>{!this.enabled||!this.domElement||(this.domElement.style.touchAction="",this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.pointerUp(this.getPointer(n)))}),d(this,"getMode",()=>this.mode),d(this,"setMode",n=>{this.mode=n}),d(this,"setTranslationSnap",n=>{this.translationSnap=n}),d(this,"setRotationSnap",n=>{this.rotationSnap=n}),d(this,"setScaleSnap",n=>{this.scaleSnap=n}),d(this,"setSize",n=>{this.size=n}),d(this,"setSpace",n=>{this.space=n}),d(this,"update",()=>{console.warn("THREE.TransformControls: update function has no more functionality and therefore has been deprecated.")}),d(this,"connect",n=>{n===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.domElement=n,this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointermove",this.onPointerHover),this.domElement.ownerDocument.addEventListener("pointerup",this.onPointerUp)}),d(this,"dispose",()=>{var n,s,o,r,a,p;(n=this.domElement)==null||n.removeEventListener("pointerdown",this.onPointerDown),(s=this.domElement)==null||s.removeEventListener("pointermove",this.onPointerHover),(r=(o=this.domElement)==null?void 0:o.ownerDocument)==null||r.removeEventListener("pointermove",this.onPointerMove),(p=(a=this.domElement)==null?void 0:a.ownerDocument)==null||p.removeEventListener("pointerup",this.onPointerUp),this.traverse(h=>{const c=h;c.geometry&&c.geometry.dispose(),c.material&&c.material.dispose()})}),this.domElement=t,this.camera=e,this.gizmo=new fn,this.add(this.gizmo),this.plane=new dn,this.add(this.plane);const i=(n,s)=>{let o=s;Object.defineProperty(this,n,{get:function(){return o!==void 0?o:s},set:function(r){o!==r&&(o=r,this.plane[n]=r,this.gizmo[n]=r,this.dispatchEvent({type:n+"-changed",value:r}),this.dispatchEvent(this.changeEvent))}}),this[n]=s,this.plane[n]=s,this.gizmo[n]=s};i("camera",this.camera),i("object",this.object),i("enabled",this.enabled),i("axis",this.axis),i("mode",this.mode),i("translationSnap",this.translationSnap),i("rotationSnap",this.rotationSnap),i("scaleSnap",this.scaleSnap),i("space",this.space),i("size",this.size),i("dragging",this.dragging),i("showX",this.showX),i("showY",this.showY),i("showZ",this.showZ),i("worldPosition",this.worldPosition),i("worldPositionStart",this.worldPositionStart),i("worldQuaternion",this.worldQuaternion),i("worldQuaternionStart",this.worldQuaternionStart),i("cameraPosition",this.cameraPosition),i("cameraQuaternion",this.cameraQuaternion),i("pointStart",this.pointStart),i("pointEnd",this.pointEnd),i("rotationAxis",this.rotationAxis),i("rotationAngle",this.rotationAngle),i("eye",this.eye),t!==void 0&&this.connect(t)}};class fn extends pe{constructor(){super(),d(this,"isTransformControlsGizmo",!0),d(this,"type","TransformControlsGizmo"),d(this,"tempVector",new v(0,0,0)),d(this,"tempEuler",new ie),d(this,"alignVector",new v(0,1,0)),d(this,"zeroVector",new v(0,0,0)),d(this,"lookAtMatrix",new z),d(this,"tempQuaternion",new X),d(this,"tempQuaternion2",new X),d(this,"identityQuaternion",new X),d(this,"unitX",new v(1,0,0)),d(this,"unitY",new v(0,1,0)),d(this,"unitZ",new v(0,0,1)),d(this,"gizmo"),d(this,"picker"),d(this,"helper"),d(this,"rotationAxis",new v),d(this,"cameraPosition",new v),d(this,"worldPositionStart",new v),d(this,"worldQuaternionStart",new X),d(this,"worldPosition",new v),d(this,"worldQuaternion",new X),d(this,"eye",new v),d(this,"camera",null),d(this,"enabled",!0),d(this,"axis",null),d(this,"mode","translate"),d(this,"space","world"),d(this,"size",1),d(this,"dragging",!1),d(this,"showX",!0),d(this,"showY",!0),d(this,"showZ",!0),d(this,"updateMatrixWorld",()=>{let R=this.space;this.mode==="scale"&&(R="local");const I=R==="local"?this.worldQuaternion:this.identityQuaternion;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let C=[];C=C.concat(this.picker[this.mode].children),C=C.concat(this.gizmo[this.mode].children),C=C.concat(this.helper[this.mode].children);for(let _=0;_<C.length;_++){const f=C[_];f.visible=!0,f.rotation.set(0,0,0),f.position.copy(this.worldPosition);let U;if(this.camera.isOrthographicCamera?U=(this.camera.top-this.camera.bottom)/this.camera.zoom:U=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),f.scale.set(1,1,1).multiplyScalar(U*this.size/7),f.tag==="helper"){f.visible=!1,f.name==="AXIS"?(f.position.copy(this.worldPositionStart),f.visible=!!this.axis,this.axis==="X"&&(this.tempQuaternion.setFromEuler(this.tempEuler.set(0,0,0)),f.quaternion.copy(I).multiply(this.tempQuaternion),Math.abs(this.alignVector.copy(this.unitX).applyQuaternion(I).dot(this.eye))>.9&&(f.visible=!1)),this.axis==="Y"&&(this.tempQuaternion.setFromEuler(this.tempEuler.set(0,0,Math.PI/2)),f.quaternion.copy(I).multiply(this.tempQuaternion),Math.abs(this.alignVector.copy(this.unitY).applyQuaternion(I).dot(this.eye))>.9&&(f.visible=!1)),this.axis==="Z"&&(this.tempQuaternion.setFromEuler(this.tempEuler.set(0,Math.PI/2,0)),f.quaternion.copy(I).multiply(this.tempQuaternion),Math.abs(this.alignVector.copy(this.unitZ).applyQuaternion(I).dot(this.eye))>.9&&(f.visible=!1)),this.axis==="XYZE"&&(this.tempQuaternion.setFromEuler(this.tempEuler.set(0,Math.PI/2,0)),this.alignVector.copy(this.rotationAxis),f.quaternion.setFromRotationMatrix(this.lookAtMatrix.lookAt(this.zeroVector,this.alignVector,this.unitY)),f.quaternion.multiply(this.tempQuaternion),f.visible=this.dragging),this.axis==="E"&&(f.visible=!1)):f.name==="START"?(f.position.copy(this.worldPositionStart),f.visible=this.dragging):f.name==="END"?(f.position.copy(this.worldPosition),f.visible=this.dragging):f.name==="DELTA"?(f.position.copy(this.worldPositionStart),f.quaternion.copy(this.worldQuaternionStart),this.tempVector.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),this.tempVector.applyQuaternion(this.worldQuaternionStart.clone().invert()),f.scale.copy(this.tempVector),f.visible=this.dragging):(f.quaternion.copy(I),this.dragging?f.position.copy(this.worldPositionStart):f.position.copy(this.worldPosition),this.axis&&(f.visible=this.axis.search(f.name)!==-1));continue}f.quaternion.copy(I),this.mode==="translate"||this.mode==="scale"?((f.name==="X"||f.name==="XYZX")&&Math.abs(this.alignVector.copy(this.unitX).applyQuaternion(I).dot(this.eye))>.99&&(f.scale.set(1e-10,1e-10,1e-10),f.visible=!1),(f.name==="Y"||f.name==="XYZY")&&Math.abs(this.alignVector.copy(this.unitY).applyQuaternion(I).dot(this.eye))>.99&&(f.scale.set(1e-10,1e-10,1e-10),f.visible=!1),(f.name==="Z"||f.name==="XYZZ")&&Math.abs(this.alignVector.copy(this.unitZ).applyQuaternion(I).dot(this.eye))>.99&&(f.scale.set(1e-10,1e-10,1e-10),f.visible=!1),f.name==="XY"&&Math.abs(this.alignVector.copy(this.unitZ).applyQuaternion(I).dot(this.eye))<.2&&(f.scale.set(1e-10,1e-10,1e-10),f.visible=!1),f.name==="YZ"&&Math.abs(this.alignVector.copy(this.unitX).applyQuaternion(I).dot(this.eye))<.2&&(f.scale.set(1e-10,1e-10,1e-10),f.visible=!1),f.name==="XZ"&&Math.abs(this.alignVector.copy(this.unitY).applyQuaternion(I).dot(this.eye))<.2&&(f.scale.set(1e-10,1e-10,1e-10),f.visible=!1),f.name.search("X")!==-1&&(this.alignVector.copy(this.unitX).applyQuaternion(I).dot(this.eye)<0?f.tag==="fwd"?f.visible=!1:f.scale.x*=-1:f.tag==="bwd"&&(f.visible=!1)),f.name.search("Y")!==-1&&(this.alignVector.copy(this.unitY).applyQuaternion(I).dot(this.eye)<0?f.tag==="fwd"?f.visible=!1:f.scale.y*=-1:f.tag==="bwd"&&(f.visible=!1)),f.name.search("Z")!==-1&&(this.alignVector.copy(this.unitZ).applyQuaternion(I).dot(this.eye)<0?f.tag==="fwd"?f.visible=!1:f.scale.z*=-1:f.tag==="bwd"&&(f.visible=!1))):this.mode==="rotate"&&(this.tempQuaternion2.copy(I),this.alignVector.copy(this.eye).applyQuaternion(this.tempQuaternion.copy(I).invert()),f.name.search("E")!==-1&&f.quaternion.setFromRotationMatrix(this.lookAtMatrix.lookAt(this.eye,this.zeroVector,this.unitY)),f.name==="X"&&(this.tempQuaternion.setFromAxisAngle(this.unitX,Math.atan2(-this.alignVector.y,this.alignVector.z)),this.tempQuaternion.multiplyQuaternions(this.tempQuaternion2,this.tempQuaternion),f.quaternion.copy(this.tempQuaternion)),f.name==="Y"&&(this.tempQuaternion.setFromAxisAngle(this.unitY,Math.atan2(this.alignVector.x,this.alignVector.z)),this.tempQuaternion.multiplyQuaternions(this.tempQuaternion2,this.tempQuaternion),f.quaternion.copy(this.tempQuaternion)),f.name==="Z"&&(this.tempQuaternion.setFromAxisAngle(this.unitZ,Math.atan2(this.alignVector.y,this.alignVector.x)),this.tempQuaternion.multiplyQuaternions(this.tempQuaternion2,this.tempQuaternion),f.quaternion.copy(this.tempQuaternion))),f.visible=f.visible&&(f.name.indexOf("X")===-1||this.showX),f.visible=f.visible&&(f.name.indexOf("Y")===-1||this.showY),f.visible=f.visible&&(f.name.indexOf("Z")===-1||this.showZ),f.visible=f.visible&&(f.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),f.material.tempOpacity=f.material.tempOpacity||f.material.opacity,f.material.tempColor=f.material.tempColor||f.material.color.clone(),f.material.color.copy(f.material.tempColor),f.material.opacity=f.material.tempOpacity,this.enabled?this.axis&&(f.name===this.axis?(f.material.opacity=1,f.material.color.lerp(new W(1,1,1),.5)):this.axis.split("").some(function(se){return f.name===se})?(f.material.opacity=1,f.material.color.lerp(new W(1,1,1),.5)):(f.material.opacity*=.25,f.material.color.lerp(new W(1,1,1),.5))):(f.material.opacity*=.5,f.material.color.lerp(new W(1,1,1),.5))}super.updateMatrixWorld()});const e=new ct({depthTest:!1,depthWrite:!1,transparent:!0,side:je,fog:!1,toneMapped:!1}),t=new xe({depthTest:!1,depthWrite:!1,transparent:!0,linewidth:1,fog:!1,toneMapped:!1}),i=e.clone();i.opacity=.15;const n=e.clone();n.opacity=.33;const s=e.clone();s.color.set(16711680);const o=e.clone();o.color.set(65280);const r=e.clone();r.color.set(255);const a=e.clone();a.opacity=.25;const p=a.clone();p.color.set(16776960);const h=a.clone();h.color.set(65535);const c=a.clone();c.color.set(16711935),e.clone().color.set(16776960);const m=t.clone();m.color.set(16711680);const g=t.clone();g.color.set(65280);const w=t.clone();w.color.set(255);const y=t.clone();y.color.set(65535);const T=t.clone();T.color.set(16711935);const P=t.clone();P.color.set(16776960);const M=t.clone();M.color.set(7895160);const A=P.clone();A.opacity=.25;const k=new te(0,.05,.2,12,1,!1),x=new me(.125,.125,.125),b=new ue;b.setAttribute("position",new H([0,0,0,1,0,0],3));const D=(R,I)=>{const C=new ue,_=[];for(let f=0;f<=64*I;++f)_.push(0,Math.cos(f/32*Math.PI)*R,Math.sin(f/32*Math.PI)*R);return C.setAttribute("position",new H(_,3)),C},$=()=>{const R=new ue;return R.setAttribute("position",new H([0,0,0,1,1,1],3)),R},Q={X:[[new S(k,s),[1,0,0],[0,0,-Math.PI/2],null,"fwd"],[new S(k,s),[1,0,0],[0,0,Math.PI/2],null,"bwd"],[new F(b,m)]],Y:[[new S(k,o),[0,1,0],null,null,"fwd"],[new S(k,o),[0,1,0],[Math.PI,0,0],null,"bwd"],[new F(b,g),null,[0,0,Math.PI/2]]],Z:[[new S(k,r),[0,0,1],[Math.PI/2,0,0],null,"fwd"],[new S(k,r),[0,0,1],[-Math.PI/2,0,0],null,"bwd"],[new F(b,w),null,[0,-Math.PI/2,0]]],XYZ:[[new S(new ge(.1,0),a.clone()),[0,0,0],[0,0,0]]],XY:[[new S(new ye(.295,.295),p.clone()),[.15,.15,0]],[new F(b,P),[.18,.3,0],null,[.125,1,1]],[new F(b,P),[.3,.18,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new S(new ye(.295,.295),h.clone()),[0,.15,.15],[0,Math.PI/2,0]],[new F(b,y),[0,.18,.3],[0,0,Math.PI/2],[.125,1,1]],[new F(b,y),[0,.3,.18],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new S(new ye(.295,.295),c.clone()),[.15,0,.15],[-Math.PI/2,0,0]],[new F(b,T),[.18,0,.3],null,[.125,1,1]],[new F(b,T),[.3,0,.18],[0,-Math.PI/2,0],[.125,1,1]]]},re={X:[[new S(new te(.2,0,1,4,1,!1),i),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new S(new te(.2,0,1,4,1,!1),i),[0,.6,0]]],Z:[[new S(new te(.2,0,1,4,1,!1),i),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new S(new ge(.2,0),i)]],XY:[[new S(new ye(.4,.4),i),[.2,.2,0]]],YZ:[[new S(new ye(.4,.4),i),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new S(new ye(.4,.4),i),[.2,0,.2],[-Math.PI/2,0,0]]]},J={START:[[new S(new ge(.01,2),n),null,null,null,"helper"]],END:[[new S(new ge(.01,2),n),null,null,null,"helper"]],DELTA:[[new F($(),n),null,null,null,"helper"]],X:[[new F(b,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new F(b,n.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new F(b,n.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},ee={X:[[new F(D(1,.5),m)],[new S(new ge(.04,0),s),[0,0,.99],null,[1,3,1]]],Y:[[new F(D(1,.5),g),null,[0,0,-Math.PI/2]],[new S(new ge(.04,0),o),[0,0,.99],null,[3,1,1]]],Z:[[new F(D(1,.5),w),null,[0,Math.PI/2,0]],[new S(new ge(.04,0),r),[.99,0,0],null,[1,3,1]]],E:[[new F(D(1.25,1),A),null,[0,Math.PI/2,0]],[new S(new te(.03,0,.15,4,1,!1),A),[1.17,0,0],[0,0,-Math.PI/2],[1,1,.001]],[new S(new te(.03,0,.15,4,1,!1),A),[-1.17,0,0],[0,0,Math.PI/2],[1,1,.001]],[new S(new te(.03,0,.15,4,1,!1),A),[0,-1.17,0],[Math.PI,0,0],[1,1,.001]],[new S(new te(.03,0,.15,4,1,!1),A),[0,1.17,0],[0,0,0],[1,1,.001]]],XYZE:[[new F(D(1,1),M),null,[0,Math.PI/2,0]]]},oe={AXIS:[[new F(b,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},V={X:[[new S(new Pe(1,.1,4,24),i),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new S(new Pe(1,.1,4,24),i),[0,0,0],[Math.PI/2,0,0]]],Z:[[new S(new Pe(1,.1,4,24),i),[0,0,0],[0,0,-Math.PI/2]]],E:[[new S(new Pe(1.25,.1,2,24),i)]],XYZE:[[new S(new Mt(.7,10,8),i)]]},N={X:[[new S(x,s),[.8,0,0],[0,0,-Math.PI/2]],[new F(b,m),null,null,[.8,1,1]]],Y:[[new S(x,o),[0,.8,0]],[new F(b,g),null,[0,0,Math.PI/2],[.8,1,1]]],Z:[[new S(x,r),[0,0,.8],[Math.PI/2,0,0]],[new F(b,w),null,[0,-Math.PI/2,0],[.8,1,1]]],XY:[[new S(x,p),[.85,.85,0],null,[2,2,.2]],[new F(b,P),[.855,.98,0],null,[.125,1,1]],[new F(b,P),[.98,.855,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new S(x,h),[0,.85,.85],null,[.2,2,2]],[new F(b,y),[0,.855,.98],[0,0,Math.PI/2],[.125,1,1]],[new F(b,y),[0,.98,.855],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new S(x,c),[.85,0,.85],null,[2,.2,2]],[new F(b,T),[.855,0,.98],null,[.125,1,1]],[new F(b,T),[.98,0,.855],[0,-Math.PI/2,0],[.125,1,1]]],XYZX:[[new S(new me(.125,.125,.125),a.clone()),[1.1,0,0]]],XYZY:[[new S(new me(.125,.125,.125),a.clone()),[0,1.1,0]]],XYZZ:[[new S(new me(.125,.125,.125),a.clone()),[0,0,1.1]]]},fe={X:[[new S(new te(.2,0,.8,4,1,!1),i),[.5,0,0],[0,0,-Math.PI/2]]],Y:[[new S(new te(.2,0,.8,4,1,!1),i),[0,.5,0]]],Z:[[new S(new te(.2,0,.8,4,1,!1),i),[0,0,.5],[Math.PI/2,0,0]]],XY:[[new S(x,i),[.85,.85,0],null,[3,3,.2]]],YZ:[[new S(x,i),[0,.85,.85],null,[.2,3,3]]],XZ:[[new S(x,i),[.85,0,.85],null,[3,.2,3]]],XYZX:[[new S(new me(.2,.2,.2),i),[1.1,0,0]]],XYZY:[[new S(new me(.2,.2,.2),i),[0,1.1,0]]],XYZZ:[[new S(new me(.2,.2,.2),i),[0,0,1.1]]]},de={X:[[new F(b,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new F(b,n.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new F(b,n.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},Y=R=>{const I=new pe;for(let C in R)for(let _=R[C].length;_--;){const f=R[C][_][0].clone(),U=R[C][_][1],se=R[C][_][2],ae=R[C][_][3],ve=R[C][_][4];f.name=C,f.tag=ve,U&&f.position.set(U[0],U[1],U[2]),se&&f.rotation.set(se[0],se[1],se[2]),ae&&f.scale.set(ae[0],ae[1],ae[2]),f.updateMatrix();const Ze=f.geometry.clone();Ze.applyMatrix4(f.matrix),f.geometry=Ze,f.renderOrder=1/0,f.position.set(0,0,0),f.rotation.set(0,0,0),f.scale.set(1,1,1),I.add(f)}return I};this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=Y(Q)),this.add(this.gizmo.rotate=Y(ee)),this.add(this.gizmo.scale=Y(N)),this.add(this.picker.translate=Y(re)),this.add(this.picker.rotate=Y(V)),this.add(this.picker.scale=Y(fe)),this.add(this.helper.translate=Y(J)),this.add(this.helper.rotate=Y(oe)),this.add(this.helper.scale=Y(de)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}}class dn extends S{constructor(){super(new ye(1e5,1e5,2,2),new ct({visible:!1,wireframe:!0,side:je,transparent:!0,opacity:.1,toneMapped:!1})),d(this,"isTransformControlsPlane",!0),d(this,"type","TransformControlsPlane"),d(this,"unitX",new v(1,0,0)),d(this,"unitY",new v(0,1,0)),d(this,"unitZ",new v(0,0,1)),d(this,"tempVector",new v),d(this,"dirVector",new v),d(this,"alignVector",new v),d(this,"tempMatrix",new z),d(this,"identityQuaternion",new X),d(this,"cameraQuaternion",new X),d(this,"worldPosition",new v),d(this,"worldQuaternion",new X),d(this,"eye",new v),d(this,"axis",null),d(this,"mode","translate"),d(this,"space","world"),d(this,"updateMatrixWorld",()=>{let e=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(e="local"),this.unitX.set(1,0,0).applyQuaternion(e==="local"?this.worldQuaternion:this.identityQuaternion),this.unitY.set(0,1,0).applyQuaternion(e==="local"?this.worldQuaternion:this.identityQuaternion),this.unitZ.set(0,0,1).applyQuaternion(e==="local"?this.worldQuaternion:this.identityQuaternion),this.alignVector.copy(this.unitY),this.mode){case"translate":case"scale":switch(this.axis){case"X":this.alignVector.copy(this.eye).cross(this.unitX),this.dirVector.copy(this.unitX).cross(this.alignVector);break;case"Y":this.alignVector.copy(this.eye).cross(this.unitY),this.dirVector.copy(this.unitY).cross(this.alignVector);break;case"Z":this.alignVector.copy(this.eye).cross(this.unitZ),this.dirVector.copy(this.unitZ).cross(this.alignVector);break;case"XY":this.dirVector.copy(this.unitZ);break;case"YZ":this.dirVector.copy(this.unitX);break;case"XZ":this.alignVector.copy(this.unitZ),this.dirVector.copy(this.unitY);break;case"XYZ":case"E":this.dirVector.set(0,0,0);break}break;case"rotate":default:this.dirVector.set(0,0,0)}this.dirVector.length()===0?this.quaternion.copy(this.cameraQuaternion):(this.tempMatrix.lookAt(this.tempVector.set(0,0,0),this.dirVector,this.alignVector),this.quaternion.setFromRotationMatrix(this.tempMatrix)),super.updateMatrixWorld()})}}const mn=j.forwardRef(({children:l,domElement:e,onChange:t,onMouseDown:i,onMouseUp:n,onObjectChange:s,object:o,makeDefault:r,camera:a,enabled:p,axis:h,mode:c,translationSnap:u,rotationSnap:m,scaleSnap:g,space:w,size:y,showX:T,showY:P,showZ:M,...A},k)=>{const x=ce(I=>I.controls),b=ce(I=>I.gl),D=ce(I=>I.events),$=ce(I=>I.camera),Q=ce(I=>I.invalidate),re=ce(I=>I.get),J=ce(I=>I.set),ee=a||$,oe=e||D.connected||b.domElement,V=j.useMemo(()=>new un(ee,oe),[ee,oe]),N=j.useRef(null);j.useLayoutEffect(()=>(o?V.attach(o instanceof pe?o:o.current):N.current instanceof pe&&V.attach(N.current),()=>void V.detach()),[o,l,V]),j.useEffect(()=>{if(x){const I=C=>x.enabled=!C.value;return V.addEventListener("dragging-changed",I),()=>V.removeEventListener("dragging-changed",I)}},[V,x]);const fe=j.useRef(),de=j.useRef(),Y=j.useRef(),R=j.useRef();return j.useLayoutEffect(()=>void(fe.current=t),[t]),j.useLayoutEffect(()=>void(de.current=i),[i]),j.useLayoutEffect(()=>void(Y.current=n),[n]),j.useLayoutEffect(()=>void(R.current=s),[s]),j.useEffect(()=>{const I=U=>{Q(),fe.current==null||fe.current(U)},C=U=>de.current==null?void 0:de.current(U),_=U=>Y.current==null?void 0:Y.current(U),f=U=>R.current==null?void 0:R.current(U);return V.addEventListener("change",I),V.addEventListener("mouseDown",C),V.addEventListener("mouseUp",_),V.addEventListener("objectChange",f),()=>{V.removeEventListener("change",I),V.removeEventListener("mouseDown",C),V.removeEventListener("mouseUp",_),V.removeEventListener("objectChange",f)}},[Q,V]),j.useEffect(()=>{if(r){const I=re().controls;return J({controls:V}),()=>J({controls:I})}},[r,V]),j.createElement(j.Fragment,null,j.createElement("primitive",{ref:k,object:V,enabled:p,axis:h,mode:c,translationSnap:u,rotationSnap:m,scaleSnap:g,space:w,size:y,showX:T,showY:P,showZ:M}),j.createElement("group",Tt({ref:N},A),l))});function gn(l,e,...t){const i=j.useRef(),n=ce(s=>s.scene);return j.useLayoutEffect(()=>{let s;if(l&&l!=null&&l.current&&e&&(i.current=s=new e(l.current,...t)),s)return s.traverse(o=>o.raycast=()=>null),n.add(s),()=>{i.current=void 0,n.remove(s),s.dispose==null||s.dispose()}},[n,e,l,...t]),Lt(()=>{var s;return void((s=i.current)==null||s.update==null?void 0:s.update())}),i}const Se=lt(l=>({objects:[],selectedObjectId:null,addObject:e=>l(t=>({objects:[...t.objects,e]})),updateObject:(e,t)=>l(i=>({objects:i.objects.map(n=>n.id===e?{...n,...t}:n)})),removeObject:e=>l(t=>({objects:t.objects.filter(i=>i.id!==e),selectedObjectId:t.selectedObjectId===e?null:t.selectedObjectId})),setSelectedObjectId:e=>l({selectedObjectId:e})})),yn=()=>{const[l,e]=j.useState(!1),[t,i]=j.useState(null),n=Se(r=>r.addObject),s=j.useCallback(async r=>{var h;r.preventDefault(),r.stopPropagation(),i(null),e(!0);const a=Array.from(r.dataTransfer.files),p=[".fbx",".obj",".gltf",".glb",".usdz"];try{for(const c of a){const u=`.${(h=c.name.split(".").pop())==null?void 0:h.toLowerCase()}`;if(p.includes(u)){const m=URL.createObjectURL(c);n({id:crypto.randomUUID(),name:c.name,type:u.slice(1),url:m,position:[0,0,0],rotation:[0,0,0],scale:[1,1,1]})}else i(`Unsupported file type: ${u}`)}}catch(c){i(c instanceof Error?c.message:"Failed to load model")}finally{e(!1)}},[n]),o=j.useCallback(r=>{r.preventDefault(),r.stopPropagation()},[]);return E.jsx("div",{onDragOver:o,onDrop:s,className:"absolute inset-0 pointer-events-auto",children:!l&&E.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:E.jsxs("div",{className:"p-8 rounded-lg border-2 border-dashed border-[#242429] bg-[#121214]/50",children:[l?E.jsx(Et,{className:"w-12 h-12 text-blue-500 animate-spin mb-4 mx-auto"}):E.jsx(tn,{className:"w-12 h-12 text-gray-400 mb-4 mx-auto"}),E.jsx("p",{className:"text-gray-400 text-center",children:t?E.jsx("span",{className:"text-red-400",children:t}):E.jsxs(E.Fragment,{children:["Drag and drop 3D models here",E.jsx("br",{}),E.jsx("span",{className:"text-sm",children:"(.fbx, .obj, .gltf, .glb, .usdz)"})]})})]})})})},wn={ambient:{intensity:.5,color:"#ffffff"},directional:{intensity:1,position:[5,5,5],target:[0,0,0],color:"#ffffff"},point:{intensity:1,position:[0,3,0],color:"#ffffff"},spot:{intensity:1,position:[3,3,3],target:[0,0,0],color:"#ffffff"}},pt=lt(l=>({lights:[],addLight:e=>l(t=>({lights:[...t.lights,{id:crypto.randomUUID(),type:e,...wn[e]}]})),removeLight:e=>l(t=>({lights:t.lights.filter(i=>i.id!==e)})),updateLight:(e,t)=>l(i=>({lights:i.lights.map(n=>n.id===e?{...n,...t}:n)}))})),vn=/^[og]\s*(.+)?/,xn=/^mtllib /,bn=/^usemtl /,Sn=/^usemap /,et=/\s+/,tt=new v,Ve=new v,nt=new v,it=new v,q=new v,Te=new W;function En(){const l={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,t){if(this.object&&this.object.fromDeclaration===!1){this.object.name=e,this.object.fromDeclaration=t!==!1;return}const i=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:t!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(n,s){const o=this._finalize(!1);o&&(o.inherited||o.groupCount<=0)&&this.materials.splice(o.index,1);const r={index:this.materials.length,name:n||"",mtllib:Array.isArray(s)&&s.length>0?s[s.length-1]:"",smooth:o!==void 0?o.smooth:this.smooth,groupStart:o!==void 0?o.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(a){const p={index:typeof a=="number"?a:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return p.clone=this.clone.bind(p),p}};return this.materials.push(r),r},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(n){const s=this.currentMaterial();if(s&&s.groupEnd===-1&&(s.groupEnd=this.geometry.vertices.length/3,s.groupCount=s.groupEnd-s.groupStart,s.inherited=!1),n&&this.materials.length>1)for(let o=this.materials.length-1;o>=0;o--)this.materials[o].groupCount<=0&&this.materials.splice(o,1);return n&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),s}},i&&i.name&&typeof i.clone=="function"){const n=i.clone(0);n.inherited=!0,this.object.materials.push(n)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(e,t){const i=parseInt(e,10);return(i>=0?i-1:i+t/3)*3},parseNormalIndex:function(e,t){const i=parseInt(e,10);return(i>=0?i-1:i+t/3)*3},parseUVIndex:function(e,t){const i=parseInt(e,10);return(i>=0?i-1:i+t/2)*2},addVertex:function(e,t,i){const n=this.vertices,s=this.object.geometry.vertices;s.push(n[e+0],n[e+1],n[e+2]),s.push(n[t+0],n[t+1],n[t+2]),s.push(n[i+0],n[i+1],n[i+2])},addVertexPoint:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,i){const n=this.normals,s=this.object.geometry.normals;s.push(n[e+0],n[e+1],n[e+2]),s.push(n[t+0],n[t+1],n[t+2]),s.push(n[i+0],n[i+1],n[i+2])},addFaceNormal:function(e,t,i){const n=this.vertices,s=this.object.geometry.normals;tt.fromArray(n,e),Ve.fromArray(n,t),nt.fromArray(n,i),q.subVectors(nt,Ve),it.subVectors(tt,Ve),q.cross(it),q.normalize(),s.push(q.x,q.y,q.z),s.push(q.x,q.y,q.z),s.push(q.x,q.y,q.z)},addColor:function(e,t,i){const n=this.colors,s=this.object.geometry.colors;n[e]!==void 0&&s.push(n[e+0],n[e+1],n[e+2]),n[t]!==void 0&&s.push(n[t+0],n[t+1],n[t+2]),n[i]!==void 0&&s.push(n[i+0],n[i+1],n[i+2])},addUV:function(e,t,i){const n=this.uvs,s=this.object.geometry.uvs;s.push(n[e+0],n[e+1]),s.push(n[t+0],n[t+1]),s.push(n[i+0],n[i+1])},addDefaultUV:function(){const e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){const t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,i,n,s,o,r,a,p){const h=this.vertices.length;let c=this.parseVertexIndex(e,h),u=this.parseVertexIndex(t,h),m=this.parseVertexIndex(i,h);if(this.addVertex(c,u,m),this.addColor(c,u,m),r!==void 0&&r!==""){const g=this.normals.length;c=this.parseNormalIndex(r,g),u=this.parseNormalIndex(a,g),m=this.parseNormalIndex(p,g),this.addNormal(c,u,m)}else this.addFaceNormal(c,u,m);if(n!==void 0&&n!==""){const g=this.uvs.length;c=this.parseUVIndex(n,g),u=this.parseUVIndex(s,g),m=this.parseUVIndex(o,g),this.addUV(c,u,m),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";const t=this.vertices.length;for(let i=0,n=e.length;i<n;i++){const s=this.parseVertexIndex(e[i],t);this.addVertexPoint(s),this.addColor(s)}},addLineGeometry:function(e,t){this.object.geometry.type="Line";const i=this.vertices.length,n=this.uvs.length;for(let s=0,o=e.length;s<o;s++)this.addVertexLine(this.parseVertexIndex(e[s],i));for(let s=0,o=t.length;s<o;s++)this.addUVLine(this.parseUVIndex(t[s],n))}};return l.startObject("",!1),l}class Pn extends De{constructor(e){super(e),this.materials=null}load(e,t,i,n){const s=this,o=new ht(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(r){try{t(s.parse(r))}catch(a){n?n(a):console.error(a),s.manager.itemError(e)}},i,n)}setMaterials(e){return this.materials=e,this}parse(e){const t=new En;e.indexOf(`\r
`)!==-1&&(e=e.replace(/\r\n/g,`
`)),e.indexOf(`\\
`)!==-1&&(e=e.replace(/\\\n/g,""));const i=e.split(`
`);let n=[];for(let r=0,a=i.length;r<a;r++){const p=i[r].trimStart();if(p.length===0)continue;const h=p.charAt(0);if(h!=="#")if(h==="v"){const c=p.split(et);switch(c[0]){case"v":t.vertices.push(parseFloat(c[1]),parseFloat(c[2]),parseFloat(c[3])),c.length>=7?(Te.setRGB(parseFloat(c[4]),parseFloat(c[5]),parseFloat(c[6])).convertSRGBToLinear(),t.colors.push(Te.r,Te.g,Te.b)):t.colors.push(void 0,void 0,void 0);break;case"vn":t.normals.push(parseFloat(c[1]),parseFloat(c[2]),parseFloat(c[3]));break;case"vt":t.uvs.push(parseFloat(c[1]),parseFloat(c[2]));break}}else if(h==="f"){const u=p.slice(1).trim().split(et),m=[];for(let w=0,y=u.length;w<y;w++){const T=u[w];if(T.length>0){const P=T.split("/");m.push(P)}}const g=m[0];for(let w=1,y=m.length-1;w<y;w++){const T=m[w],P=m[w+1];t.addFace(g[0],T[0],P[0],g[1],T[1],P[1],g[2],T[2],P[2])}}else if(h==="l"){const c=p.substring(1).trim().split(" ");let u=[];const m=[];if(p.indexOf("/")===-1)u=c;else for(let g=0,w=c.length;g<w;g++){const y=c[g].split("/");y[0]!==""&&u.push(y[0]),y[1]!==""&&m.push(y[1])}t.addLineGeometry(u,m)}else if(h==="p"){const u=p.slice(1).trim().split(" ");t.addPointGeometry(u)}else if((n=vn.exec(p))!==null){const c=(" "+n[0].slice(1).trim()).slice(1);t.startObject(c)}else if(bn.test(p))t.object.startMaterial(p.substring(7).trim(),t.materialLibraries);else if(xn.test(p))t.materialLibraries.push(p.substring(7).trim());else if(Sn.test(p))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(h==="s"){if(n=p.split(" "),n.length>1){const u=n[1].trim().toLowerCase();t.object.smooth=u!=="0"&&u!=="off"}else t.object.smooth=!0;const c=t.object.currentMaterial();c&&(c.smooth=t.object.smooth)}else{if(p==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+p+'"')}}t.finalize();const s=new _e;if(s.materialLibraries=[].concat(t.materialLibraries),!(t.objects.length===1&&t.objects[0].geometry.vertices.length===0)===!0)for(let r=0,a=t.objects.length;r<a;r++){const p=t.objects[r],h=p.geometry,c=p.materials,u=h.type==="Line",m=h.type==="Points";let g=!1;if(h.vertices.length===0)continue;const w=new ue;w.setAttribute("position",new H(h.vertices,3)),h.normals.length>0&&w.setAttribute("normal",new H(h.normals,3)),h.colors.length>0&&(g=!0,w.setAttribute("color",new H(h.colors,3))),h.hasUVIndices===!0&&w.setAttribute("uv",new H(h.uvs,2));const y=[];for(let P=0,M=c.length;P<M;P++){const A=c[P],k=A.name+"_"+A.smooth+"_"+g;let x=t.materials[k];if(this.materials!==null){if(x=this.materials.create(A.name),u&&x&&!(x instanceof xe)){const b=new xe;Ge.prototype.copy.call(b,x),b.color.copy(x.color),x=b}else if(m&&x&&!(x instanceof Ie)){const b=new Ie({size:10,sizeAttenuation:!1});Ge.prototype.copy.call(b,x),b.color.copy(x.color),b.map=x.map,x=b}}x===void 0&&(u?x=new xe:m?x=new Ie({size:1,sizeAttenuation:!1}):x=new Fe,x.name=A.name,x.flatShading=!A.smooth,x.vertexColors=g,t.materials[k]=x),y.push(x)}let T;if(y.length>1){for(let P=0,M=c.length;P<M;P++){const A=c[P];w.addGroup(A.groupStart,A.groupCount,P)}u?T=new He(w,y):m?T=new ke(w,y):T=new S(w,y)}else u?T=new He(w,y[0]):m?T=new ke(w,y[0]):T=new S(w,y[0]);T.name=p.name,s.add(T)}else if(t.vertices.length>0){const r=new Ie({size:1,sizeAttenuation:!1}),a=new ue;a.setAttribute("position",new H(t.vertices,3)),t.colors.length>0&&t.colors[0]!==void 0&&(a.setAttribute("color",new H(t.colors,3)),r.vertexColors=!0);const p=new ke(a,r);s.add(p)}return s}}/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.6.9
*/var st=function(l){return URL.createObjectURL(new Blob([l],{type:"text/javascript"}))};try{URL.revokeObjectURL(st(""))}catch{st=function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)}}var K=Uint8Array,he=Uint16Array,Ue=Uint32Array,ut=new K([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),ft=new K([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),In=new K([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),dt=function(l,e){for(var t=new he(31),i=0;i<31;++i)t[i]=e+=1<<l[i-1];for(var n=new Ue(t[30]),i=1;i<30;++i)for(var s=t[i];s<t[i+1];++s)n[s]=s-t[i]<<5|i;return[t,n]},mt=dt(ut,2),gt=mt[0],Mn=mt[1];gt[28]=258,Mn[258]=28;var Tn=dt(ft,0),Ln=Tn[0],Ye=new he(32768);for(var O=0;O<32768;++O){var le=(O&43690)>>>1|(O&21845)<<1;le=(le&52428)>>>2|(le&13107)<<2,le=(le&61680)>>>4|(le&3855)<<4,Ye[O]=((le&65280)>>>8|(le&255)<<8)>>>1}var be=function(l,e,t){for(var i=l.length,n=0,s=new he(e);n<i;++n)++s[l[n]-1];var o=new he(e);for(n=0;n<e;++n)o[n]=o[n-1]+s[n-1]<<1;var r;if(t){r=new he(1<<e);var a=15-e;for(n=0;n<i;++n)if(l[n])for(var p=n<<4|l[n],h=e-l[n],c=o[l[n]-1]++<<h,u=c|(1<<h)-1;c<=u;++c)r[Ye[c]>>>a]=p}else for(r=new he(i),n=0;n<i;++n)l[n]&&(r[n]=Ye[o[l[n]-1]++]>>>15-l[n]);return r},Ee=new K(288);for(var O=0;O<144;++O)Ee[O]=8;for(var O=144;O<256;++O)Ee[O]=9;for(var O=256;O<280;++O)Ee[O]=7;for(var O=280;O<288;++O)Ee[O]=8;var yt=new K(32);for(var O=0;O<32;++O)yt[O]=5;var An=be(Ee,9,1),Fn=be(yt,5,1),Xe=function(l){for(var e=l[0],t=1;t<l.length;++t)l[t]>e&&(e=l[t]);return e},ne=function(l,e,t){var i=e/8|0;return(l[i]|l[i+1]<<8)>>(e&7)&t},ze=function(l,e){var t=e/8|0;return(l[t]|l[t+1]<<8|l[t+2]<<16)>>(e&7)},jn=function(l){return(l/8|0)+(l&7&&1)},Dn=function(l,e,t){(t==null||t>l.length)&&(t=l.length);var i=new(l instanceof he?he:l instanceof Ue?Ue:K)(t-e);return i.set(l.subarray(e,t)),i},Cn=function(l,e,t){var i=l.length;if(!i||t&&!t.l&&i<5)return e||new K(0);var n=!e||t,s=!t||t.i;t||(t={}),e||(e=new K(i*3));var o=function(se){var ae=e.length;if(se>ae){var ve=new K(Math.max(ae*2,se));ve.set(e),e=ve}},r=t.f||0,a=t.p||0,p=t.b||0,h=t.l,c=t.d,u=t.m,m=t.n,g=i*8;do{if(!h){t.f=r=ne(l,a,1);var w=ne(l,a+1,3);if(a+=3,w)if(w==1)h=An,c=Fn,u=9,m=5;else if(w==2){var M=ne(l,a,31)+257,A=ne(l,a+10,15)+4,k=M+ne(l,a+5,31)+1;a+=14;for(var x=new K(k),b=new K(19),D=0;D<A;++D)b[In[D]]=ne(l,a+D*3,7);a+=A*3;for(var $=Xe(b),Q=(1<<$)-1,re=be(b,$,1),D=0;D<k;){var J=re[ne(l,a,Q)];a+=J&15;var y=J>>>4;if(y<16)x[D++]=y;else{var ee=0,oe=0;for(y==16?(oe=3+ne(l,a,3),a+=2,ee=x[D-1]):y==17?(oe=3+ne(l,a,7),a+=3):y==18&&(oe=11+ne(l,a,127),a+=7);oe--;)x[D++]=ee}}var V=x.subarray(0,M),N=x.subarray(M);u=Xe(V),m=Xe(N),h=be(V,u,1),c=be(N,m,1)}else throw"invalid block type";else{var y=jn(a)+4,T=l[y-4]|l[y-3]<<8,P=y+T;if(P>i){if(s)throw"unexpected EOF";break}n&&o(p+T),e.set(l.subarray(y,P),p),t.b=p+=T,t.p=a=P*8;continue}if(a>g){if(s)throw"unexpected EOF";break}}n&&o(p+131072);for(var fe=(1<<u)-1,de=(1<<m)-1,Y=a;;Y=a){var ee=h[ze(l,a)&fe],R=ee>>>4;if(a+=ee&15,a>g){if(s)throw"unexpected EOF";break}if(!ee)throw"invalid length/literal";if(R<256)e[p++]=R;else if(R==256){Y=a,h=null;break}else{var I=R-254;if(R>264){var D=R-257,C=ut[D];I=ne(l,a,(1<<C)-1)+gt[D],a+=C}var _=c[ze(l,a)&de],f=_>>>4;if(!_)throw"invalid distance";a+=_&15;var N=Ln[f];if(f>3){var C=ft[f];N+=ze(l,a)&(1<<C)-1,a+=C}if(a>g){if(s)throw"unexpected EOF";break}n&&o(p+131072);for(var U=p+I;p<U;p+=4)e[p]=e[p-N],e[p+1]=e[p+1-N],e[p+2]=e[p+2-N],e[p+3]=e[p+3-N];p=U}}t.l=h,t.p=Y,t.b=p,h&&(r=1,t.m=u,t.d=c,t.n=m)}while(!r);return p==e.length?e:Dn(e,0,p)},Rn=new K(0),kn=function(l){if((l[0]&15)!=8||l[0]>>>4>7||(l[0]<<8|l[1])%31)throw"invalid zlib data";if(l[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function On(l,e){return Cn((kn(l),l.subarray(2,-4)),e)}var Vn=typeof TextDecoder<"u"&&new TextDecoder,Xn=0;try{Vn.decode(Rn,{stream:!0}),Xn=1}catch{}function wt(l,e,t){const i=t.length-l-1;if(e>=t[i])return i-1;if(e<=t[l])return l;let n=l,s=i,o=Math.floor((n+s)/2);for(;e<t[o]||e>=t[o+1];)e<t[o]?s=o:n=o,o=Math.floor((n+s)/2);return o}function zn(l,e,t,i){const n=[],s=[],o=[];n[0]=1;for(let r=1;r<=t;++r){s[r]=e-i[l+1-r],o[r]=i[l+r]-e;let a=0;for(let p=0;p<r;++p){const h=o[p+1],c=s[r-p],u=n[p]/(h+c);n[p]=a+h*u,a=c*u}n[r]=a}return n}function Bn(l,e,t,i){const n=wt(l,i,e),s=zn(n,i,l,e),o=new Re(0,0,0,0);for(let r=0;r<=l;++r){const a=t[n-l+r],p=s[r],h=a.w*p;o.x+=a.x*h,o.y+=a.y*h,o.z+=a.z*h,o.w+=a.w*p}return o}function Qn(l,e,t,i,n){const s=[];for(let c=0;c<=t;++c)s[c]=0;const o=[];for(let c=0;c<=i;++c)o[c]=s.slice(0);const r=[];for(let c=0;c<=t;++c)r[c]=s.slice(0);r[0][0]=1;const a=s.slice(0),p=s.slice(0);for(let c=1;c<=t;++c){a[c]=e-n[l+1-c],p[c]=n[l+c]-e;let u=0;for(let m=0;m<c;++m){const g=p[m+1],w=a[c-m];r[c][m]=g+w;const y=r[m][c-1]/r[c][m];r[m][c]=u+g*y,u=w*y}r[c][c]=u}for(let c=0;c<=t;++c)o[0][c]=r[c][t];for(let c=0;c<=t;++c){let u=0,m=1;const g=[];for(let w=0;w<=t;++w)g[w]=s.slice(0);g[0][0]=1;for(let w=1;w<=i;++w){let y=0;const T=c-w,P=t-w;c>=w&&(g[m][0]=g[u][0]/r[P+1][T],y=g[m][0]*r[T][P]);const M=T>=-1?1:-T,A=c-1<=P?w-1:t-c;for(let x=M;x<=A;++x)g[m][x]=(g[u][x]-g[u][x-1])/r[P+1][T+x],y+=g[m][x]*r[T+x][P];c<=P&&(g[m][w]=-g[u][w-1]/r[P+1][c],y+=g[m][w]*r[c][P]),o[w][c]=y;const k=u;u=m,m=k}}let h=t;for(let c=1;c<=i;++c){for(let u=0;u<=t;++u)o[c][u]*=h;h*=t-c}return o}function _n(l,e,t,i,n){const s=n<l?n:l,o=[],r=wt(l,i,e),a=Qn(r,i,l,s,e),p=[];for(let h=0;h<t.length;++h){const c=t[h].clone(),u=c.w;c.x*=u,c.y*=u,c.z*=u,p[h]=c}for(let h=0;h<=s;++h){const c=p[r-l].clone().multiplyScalar(a[h][0]);for(let u=1;u<=l;++u)c.add(p[r-l+u].clone().multiplyScalar(a[h][u]));o[h]=c}for(let h=s+1;h<=n+1;++h)o[h]=new Re(0,0,0);return o}function Un(l,e){let t=1;for(let n=2;n<=l;++n)t*=n;let i=1;for(let n=2;n<=e;++n)i*=n;for(let n=2;n<=l-e;++n)i*=n;return t/i}function Yn(l){const e=l.length,t=[],i=[];for(let s=0;s<e;++s){const o=l[s];t[s]=new v(o.x,o.y,o.z),i[s]=o.w}const n=[];for(let s=0;s<e;++s){const o=t[s].clone();for(let r=1;r<=s;++r)o.sub(n[s-r].clone().multiplyScalar(Un(s,r)*i[r]));n[s]=o.divideScalar(i[0])}return n}function Zn(l,e,t,i,n){const s=_n(l,e,t,i,n);return Yn(s)}class Gn extends At{constructor(e,t,i,n,s){super(),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=n||0,this.endKnot=s||this.knots.length-1;for(let o=0;o<i.length;++o){const r=i[o];this.controlPoints[o]=new Re(r.x,r.y,r.z,r.w)}}getPoint(e,t=new v){const i=t,n=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),s=Bn(this.degree,this.knots,this.controlPoints,n);return s.w!==1&&s.divideScalar(s.w),i.set(s.x,s.y,s.z)}getTangent(e,t=new v){const i=t,n=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),s=Zn(this.degree,this.knots,this.controlPoints,n,1);return i.copy(s[1]).normalize(),i}}let L,B,Z;class Hn extends De{constructor(e){super(e)}load(e,t,i,n){const s=this,o=s.path===""?Ft.extractUrlBase(e):s.path,r=new ht(this.manager);r.setPath(s.path),r.setResponseType("arraybuffer"),r.setRequestHeader(s.requestHeader),r.setWithCredentials(s.withCredentials),r.load(e,function(a){try{t(s.parse(a,o))}catch(p){n?n(p):console.error(p),s.manager.itemError(e)}},i,n)}parse(e,t){if(Jn(e))L=new $n().parse(e);else{const n=St(e);if(!ei(n))throw new Error("THREE.FBXLoader: Unknown format.");if(ot(n)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+ot(n));L=new Kn().parse(n)}const i=new jt(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);return new Nn(i,this.manager).parse(L)}}class Nn{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){B=this.parseConnections();const e=this.parseImages(),t=this.parseTextures(e),i=this.parseMaterials(t),n=this.parseDeformers(),s=new Wn().parse(n);return this.parseScene(n,s,i),Z}parseConnections(){const e=new Map;return"Connections"in L&&L.Connections.connections.forEach(function(i){const n=i[0],s=i[1],o=i[2];e.has(n)||e.set(n,{parents:[],children:[]});const r={ID:s,relationship:o};e.get(n).parents.push(r),e.has(s)||e.set(s,{parents:[],children:[]});const a={ID:n,relationship:o};e.get(s).children.push(a)}),e}parseImages(){const e={},t={};if("Video"in L.Objects){const i=L.Objects.Video;for(const n in i){const s=i[n],o=parseInt(n);if(e[o]=s.RelativeFilename||s.Filename,"Content"in s){const r=s.Content instanceof ArrayBuffer&&s.Content.byteLength>0,a=typeof s.Content=="string"&&s.Content!=="";if(r||a){const p=this.parseImage(i[n]);t[s.RelativeFilename||s.Filename]=p}}}}for(const i in e){const n=e[i];t[n]!==void 0?e[i]=t[n]:e[i]=e[i].split("\\").pop()}return e}parseImage(e){const t=e.Content,i=e.RelativeFilename||e.Filename,n=i.slice(i.lastIndexOf(".")+1).toLowerCase();let s;switch(n){case"bmp":s="image/bmp";break;case"jpg":case"jpeg":s="image/jpeg";break;case"png":s="image/png";break;case"tif":s="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",i),s="image/tga";break;default:console.warn('FBXLoader: Image type "'+n+'" is not supported.');return}if(typeof t=="string")return"data:"+s+";base64,"+t;{const o=new Uint8Array(t);return window.URL.createObjectURL(new Blob([o],{type:s}))}}parseTextures(e){const t=new Map;if("Texture"in L.Objects){const i=L.Objects.Texture;for(const n in i){const s=this.parseTexture(i[n],e);t.set(parseInt(n),s)}}return t}parseTexture(e,t){const i=this.loadTexture(e,t);i.ID=e.id,i.name=e.attrName;const n=e.WrapModeU,s=e.WrapModeV,o=n!==void 0?n.value:0,r=s!==void 0?s.value:0;if(i.wrapS=o===0?Ne:We,i.wrapT=r===0?Ne:We,"Scaling"in e){const a=e.Scaling.value;i.repeat.x=a[0],i.repeat.y=a[1]}if("Translation"in e){const a=e.Translation.value;i.offset.x=a[0],i.offset.y=a[1]}return i}loadTexture(e,t){let i;const n=this.textureLoader.path,s=B.get(e.id).children;s!==void 0&&s.length>0&&t[s[0].ID]!==void 0&&(i=t[s[0].ID],(i.indexOf("blob:")===0||i.indexOf("data:")===0)&&this.textureLoader.setPath(void 0));let o;const r=e.FileName.slice(-3).toLowerCase();if(r==="tga"){const a=this.manager.getHandler(".tga");a===null?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),o=new Oe):(a.setPath(this.textureLoader.path),o=a.load(i))}else if(r==="dds"){const a=this.manager.getHandler(".dds");a===null?(console.warn("FBXLoader: DDS loader not found, creating placeholder texture for",e.RelativeFilename),o=new Oe):(a.setPath(this.textureLoader.path),o=a.load(i))}else r==="psd"?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),o=new Oe):o=this.textureLoader.load(i);return this.textureLoader.setPath(n),o}parseMaterials(e){const t=new Map;if("Material"in L.Objects){const i=L.Objects.Material;for(const n in i){const s=this.parseMaterial(i[n],e);s!==null&&t.set(parseInt(n),s)}}return t}parseMaterial(e,t){const i=e.id,n=e.attrName;let s=e.ShadingModel;if(typeof s=="object"&&(s=s.value),!B.has(i))return null;const o=this.parseParameters(e,t,i);let r;switch(s.toLowerCase()){case"phong":r=new Fe;break;case"lambert":r=new Dt;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',s),r=new Fe;break}return r.setValues(o),r.name=n,r}parseParameters(e,t,i){const n={};e.BumpFactor&&(n.bumpScale=e.BumpFactor.value),e.Diffuse?n.color=new W().fromArray(e.Diffuse.value).convertSRGBToLinear():e.DiffuseColor&&(e.DiffuseColor.type==="Color"||e.DiffuseColor.type==="ColorRGB")&&(n.color=new W().fromArray(e.DiffuseColor.value).convertSRGBToLinear()),e.DisplacementFactor&&(n.displacementScale=e.DisplacementFactor.value),e.Emissive?n.emissive=new W().fromArray(e.Emissive.value).convertSRGBToLinear():e.EmissiveColor&&(e.EmissiveColor.type==="Color"||e.EmissiveColor.type==="ColorRGB")&&(n.emissive=new W().fromArray(e.EmissiveColor.value).convertSRGBToLinear()),e.EmissiveFactor&&(n.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(n.opacity=parseFloat(e.Opacity.value)),n.opacity<1&&(n.transparent=!0),e.ReflectionFactor&&(n.reflectivity=e.ReflectionFactor.value),e.Shininess&&(n.shininess=e.Shininess.value),e.Specular?n.specular=new W().fromArray(e.Specular.value).convertSRGBToLinear():e.SpecularColor&&e.SpecularColor.type==="Color"&&(n.specular=new W().fromArray(e.SpecularColor.value).convertSRGBToLinear());const s=this;return B.get(i).children.forEach(function(o){const r=o.relationship;switch(r){case"Bump":n.bumpMap=s.getTexture(t,o.ID);break;case"Maya|TEX_ao_map":n.aoMap=s.getTexture(t,o.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":n.map=s.getTexture(t,o.ID),n.map!==void 0&&(n.map.colorSpace=Me);break;case"DisplacementColor":n.displacementMap=s.getTexture(t,o.ID);break;case"EmissiveColor":n.emissiveMap=s.getTexture(t,o.ID),n.emissiveMap!==void 0&&(n.emissiveMap.colorSpace=Me);break;case"NormalMap":case"Maya|TEX_normal_map":n.normalMap=s.getTexture(t,o.ID);break;case"ReflectionColor":n.envMap=s.getTexture(t,o.ID),n.envMap!==void 0&&(n.envMap.mapping=Ct,n.envMap.colorSpace=Me);break;case"SpecularColor":n.specularMap=s.getTexture(t,o.ID),n.specularMap!==void 0&&(n.specularMap.colorSpace=Me);break;case"TransparentColor":case"TransparencyFactor":n.alphaMap=s.getTexture(t,o.ID),n.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",r);break}}),n}getTexture(e,t){return"LayeredTexture"in L.Objects&&t in L.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=B.get(t).children[0].ID),e.get(t)}parseDeformers(){const e={},t={};if("Deformer"in L.Objects){const i=L.Objects.Deformer;for(const n in i){const s=i[n],o=B.get(parseInt(n));if(s.attrType==="Skin"){const r=this.parseSkeleton(o,i);r.ID=n,o.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),r.geometryID=o.parents[0].ID,e[n]=r}else if(s.attrType==="BlendShape"){const r={id:n};r.rawTargets=this.parseMorphTargets(o,i),r.id=n,o.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[n]=r}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){const i=[];return e.children.forEach(function(n){const s=t[n.ID];if(s.attrType!=="Cluster")return;const o={ID:n.ID,indices:[],weights:[],transformLink:new z().fromArray(s.TransformLink.a)};"Indexes"in s&&(o.indices=s.Indexes.a,o.weights=s.Weights.a),i.push(o)}),{rawBones:i,bones:[]}}parseMorphTargets(e,t){const i=[];for(let n=0;n<e.children.length;n++){const s=e.children[n],o=t[s.ID],r={name:o.attrName,initialWeight:o.DeformPercent,id:o.id,fullWeights:o.FullWeights.a};if(o.attrType!=="BlendShapeChannel")return;r.geoID=B.get(parseInt(s.ID)).children.filter(function(a){return a.relationship===void 0})[0].ID,i.push(r)}return i}parseScene(e,t,i){Z=new _e;const n=this.parseModels(e.skeletons,t,i),s=L.Objects.Model,o=this;n.forEach(function(a){const p=s[a.ID];o.setLookAtProperties(a,p),B.get(a.ID).parents.forEach(function(c){const u=n.get(c.ID);u!==void 0&&u.add(a)}),a.parent===null&&Z.add(a)}),this.bindSkeleton(e.skeletons,t,n),this.addGlobalSceneSettings(),Z.traverse(function(a){if(a.userData.transformData){a.parent&&(a.userData.transformData.parentMatrix=a.parent.matrix,a.userData.transformData.parentMatrixWorld=a.parent.matrixWorld);const p=xt(a.userData.transformData);a.applyMatrix4(p),a.updateWorldMatrix()}});const r=new qn().parse();Z.children.length===1&&Z.children[0].isGroup&&(Z.children[0].animations=r,Z=Z.children[0]),Z.animations=r}parseModels(e,t,i){const n=new Map,s=L.Objects.Model;for(const o in s){const r=parseInt(o),a=s[o],p=B.get(r);let h=this.buildSkeleton(p,e,r,a.attrName);if(!h){switch(a.attrType){case"Camera":h=this.createCamera(p);break;case"Light":h=this.createLight(p);break;case"Mesh":h=this.createMesh(p,t,i);break;case"NurbsCurve":h=this.createCurve(p,t);break;case"LimbNode":case"Root":h=new qe;break;case"Null":default:h=new _e;break}h.name=a.attrName?Ce.sanitizeNodeName(a.attrName):"",h.userData.originalName=a.attrName,h.ID=r}this.getTransformData(h,a),n.set(r,h)}return n}buildSkeleton(e,t,i,n){let s=null;return e.parents.forEach(function(o){for(const r in t){const a=t[r];a.rawBones.forEach(function(p,h){if(p.ID===o.ID){const c=s;s=new qe,s.matrixWorld.copy(p.transformLink),s.name=n?Ce.sanitizeNodeName(n):"",s.userData.originalName=n,s.ID=i,a.bones[h]=s,c!==null&&s.add(c)}})}}),s}createCamera(e){let t,i;if(e.children.forEach(function(n){const s=L.Objects.NodeAttribute[n.ID];s!==void 0&&(i=s)}),i===void 0)t=new pe;else{let n=0;i.CameraProjectionType!==void 0&&i.CameraProjectionType.value===1&&(n=1);let s=1;i.NearPlane!==void 0&&(s=i.NearPlane.value/1e3);let o=1e3;i.FarPlane!==void 0&&(o=i.FarPlane.value/1e3);let r=window.innerWidth,a=window.innerHeight;i.AspectWidth!==void 0&&i.AspectHeight!==void 0&&(r=i.AspectWidth.value,a=i.AspectHeight.value);const p=r/a;let h=45;i.FieldOfView!==void 0&&(h=i.FieldOfView.value);const c=i.FocalLength?i.FocalLength.value:null;switch(n){case 0:t=new kt(h,p,s,o),c!==null&&t.setFocalLength(c);break;case 1:t=new Rt(-r/2,r/2,a/2,-a/2,s,o);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+n+"."),t=new pe;break}}return t}createLight(e){let t,i;if(e.children.forEach(function(n){const s=L.Objects.NodeAttribute[n.ID];s!==void 0&&(i=s)}),i===void 0)t=new pe;else{let n;i.LightType===void 0?n=0:n=i.LightType.value;let s=16777215;i.Color!==void 0&&(s=new W().fromArray(i.Color.value).convertSRGBToLinear());let o=i.Intensity===void 0?1:i.Intensity.value/100;i.CastLightOnObject!==void 0&&i.CastLightOnObject.value===0&&(o=0);let r=0;i.FarAttenuationEnd!==void 0&&(i.EnableFarAttenuation!==void 0&&i.EnableFarAttenuation.value===0?r=0:r=i.FarAttenuationEnd.value);const a=1;switch(n){case 0:t=new Ke(s,o,r,a);break;case 1:t=new Vt(s,o);break;case 2:let p=Math.PI/3;i.InnerAngle!==void 0&&(p=G.degToRad(i.InnerAngle.value));let h=0;i.OuterAngle!==void 0&&(h=G.degToRad(i.OuterAngle.value),h=Math.max(h,1)),t=new Ot(s,o,r,p,h,a);break;default:console.warn("THREE.FBXLoader: Unknown light type "+i.LightType.value+", defaulting to a PointLight."),t=new Ke(s,o);break}i.CastShadows!==void 0&&i.CastShadows.value===1&&(t.castShadow=!0)}return t}createMesh(e,t,i){let n,s=null,o=null;const r=[];return e.children.forEach(function(a){t.has(a.ID)&&(s=t.get(a.ID)),i.has(a.ID)&&r.push(i.get(a.ID))}),r.length>1?o=r:r.length>0?o=r[0]:(o=new Fe({name:De.DEFAULT_MATERIAL_NAME,color:13421772}),r.push(o)),"color"in s.attributes&&r.forEach(function(a){a.vertexColors=!0}),s.FBX_Deformer?(n=new Xt(s,o),n.normalizeSkinWeights()):n=new S(s,o),n}createCurve(e,t){const i=e.children.reduce(function(s,o){return t.has(o.ID)&&(s=t.get(o.ID)),s},null),n=new xe({name:De.DEFAULT_MATERIAL_NAME,color:3342591,linewidth:1});return new F(i,n)}getTransformData(e,t){const i={};"InheritType"in t&&(i.inheritType=parseInt(t.InheritType.value)),"RotationOrder"in t?i.eulerOrder=bt(t.RotationOrder.value):i.eulerOrder="ZYX","Lcl_Translation"in t&&(i.translation=t.Lcl_Translation.value),"PreRotation"in t&&(i.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(i.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(i.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(i.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(i.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(i.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(i.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(i.rotationPivot=t.RotationPivot.value),e.userData.transformData=i}setLookAtProperties(e,t){"LookAtProperty"in t&&B.get(e.ID).children.forEach(function(n){if(n.relationship==="LookAtProperty"){const s=L.Objects.Model[n.ID];if("Lcl_Translation"in s){const o=s.Lcl_Translation.value;e.target!==void 0?(e.target.position.fromArray(o),Z.add(e.target)):e.lookAt(new v().fromArray(o))}}})}bindSkeleton(e,t,i){const n=this.parsePoseNodes();for(const s in e){const o=e[s];B.get(parseInt(o.ID)).parents.forEach(function(a){if(t.has(a.ID)){const p=a.ID;B.get(p).parents.forEach(function(c){i.has(c.ID)&&i.get(c.ID).bind(new zt(o.bones),n[c.ID])})}})}}parsePoseNodes(){const e={};if("Pose"in L.Objects){const t=L.Objects.Pose;for(const i in t)if(t[i].attrType==="BindPose"&&t[i].NbPoseNodes>0){const n=t[i].PoseNode;Array.isArray(n)?n.forEach(function(s){e[s.Node]=new z().fromArray(s.Matrix.a)}):e[n.Node]=new z().fromArray(n.Matrix.a)}}return e}addGlobalSceneSettings(){if("GlobalSettings"in L){if("AmbientColor"in L.GlobalSettings){const e=L.GlobalSettings.AmbientColor.value,t=e[0],i=e[1],n=e[2];if(t!==0||i!==0||n!==0){const s=new W(t,i,n).convertSRGBToLinear();Z.add(new Bt(s,1))}}"UnitScaleFactor"in L.GlobalSettings&&(Z.userData.unitScaleFactor=L.GlobalSettings.UnitScaleFactor.value)}}}class Wn{constructor(){this.negativeMaterialIndices=!1}parse(e){const t=new Map;if("Geometry"in L.Objects){const i=L.Objects.Geometry;for(const n in i){const s=B.get(parseInt(n)),o=this.parseGeometry(s,i[n],e);t.set(parseInt(n),o)}}return this.negativeMaterialIndices===!0&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),t}parseGeometry(e,t,i){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,i);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,i){const n=i.skeletons,s=[],o=e.parents.map(function(c){return L.Objects.Model[c.ID]});if(o.length===0)return;const r=e.children.reduce(function(c,u){return n[u.ID]!==void 0&&(c=n[u.ID]),c},null);e.children.forEach(function(c){i.morphTargets[c.ID]!==void 0&&s.push(i.morphTargets[c.ID])});const a=o[0],p={};"RotationOrder"in a&&(p.eulerOrder=bt(a.RotationOrder.value)),"InheritType"in a&&(p.inheritType=parseInt(a.InheritType.value)),"GeometricTranslation"in a&&(p.translation=a.GeometricTranslation.value),"GeometricRotation"in a&&(p.rotation=a.GeometricRotation.value),"GeometricScaling"in a&&(p.scale=a.GeometricScaling.value);const h=xt(p);return this.genGeometry(t,r,s,h)}genGeometry(e,t,i,n){const s=new ue;e.attrName&&(s.name=e.attrName);const o=this.parseGeoNode(e,t),r=this.genBuffers(o),a=new H(r.vertex,3);if(a.applyMatrix4(n),s.setAttribute("position",a),r.colors.length>0&&s.setAttribute("color",new H(r.colors,3)),t&&(s.setAttribute("skinIndex",new Qt(r.weightsIndices,4)),s.setAttribute("skinWeight",new H(r.vertexWeights,4)),s.FBX_Deformer=t),r.normal.length>0){const p=new _t().getNormalMatrix(n),h=new H(r.normal,3);h.applyNormalMatrix(p),s.setAttribute("normal",h)}if(r.uvs.forEach(function(p,h){const c=h===0?"uv":`uv${h}`;s.setAttribute(c,new H(r.uvs[h],2))}),o.material&&o.material.mappingType!=="AllSame"){let p=r.materialIndex[0],h=0;if(r.materialIndex.forEach(function(c,u){c!==p&&(s.addGroup(h,u-h,p),p=c,h=u)}),s.groups.length>0){const c=s.groups[s.groups.length-1],u=c.start+c.count;u!==r.materialIndex.length&&s.addGroup(u,r.materialIndex.length-u,p)}s.groups.length===0&&s.addGroup(0,r.materialIndex.length,r.materialIndex[0])}return this.addMorphTargets(s,e,i,n),s}parseGeoNode(e,t){const i={};if(i.vertexPositions=e.Vertices!==void 0?e.Vertices.a:[],i.vertexIndices=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(i.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(i.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(i.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){i.uv=[];let n=0;for(;e.LayerElementUV[n];)e.LayerElementUV[n].UV&&i.uv.push(this.parseUVs(e.LayerElementUV[n])),n++}return i.weightTable={},t!==null&&(i.skeleton=t,t.rawBones.forEach(function(n,s){n.indices.forEach(function(o,r){i.weightTable[o]===void 0&&(i.weightTable[o]=[]),i.weightTable[o].push({id:s,weight:n.weights[r]})})})),i}genBuffers(e){const t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let i=0,n=0,s=!1,o=[],r=[],a=[],p=[],h=[],c=[];const u=this;return e.vertexIndices.forEach(function(m,g){let w,y=!1;m<0&&(m=m^-1,y=!0);let T=[],P=[];if(o.push(m*3,m*3+1,m*3+2),e.color){const M=Le(g,i,m,e.color);a.push(M[0],M[1],M[2])}if(e.skeleton){if(e.weightTable[m]!==void 0&&e.weightTable[m].forEach(function(M){P.push(M.weight),T.push(M.id)}),P.length>4){s||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),s=!0);const M=[0,0,0,0],A=[0,0,0,0];P.forEach(function(k,x){let b=k,D=T[x];A.forEach(function($,Q,re){if(b>$){re[Q]=b,b=$;const J=M[Q];M[Q]=D,D=J}})}),T=M,P=A}for(;P.length<4;)P.push(0),T.push(0);for(let M=0;M<4;++M)h.push(P[M]),c.push(T[M])}if(e.normal){const M=Le(g,i,m,e.normal);r.push(M[0],M[1],M[2])}e.material&&e.material.mappingType!=="AllSame"&&(w=Le(g,i,m,e.material)[0],w<0&&(u.negativeMaterialIndices=!0,w=0)),e.uv&&e.uv.forEach(function(M,A){const k=Le(g,i,m,M);p[A]===void 0&&(p[A]=[]),p[A].push(k[0]),p[A].push(k[1])}),n++,y&&(u.genFace(t,e,o,w,r,a,p,h,c,n),i++,n=0,o=[],r=[],a=[],p=[],h=[],c=[])}),t}getNormalNewell(e){const t=new v(0,0,0);for(let i=0;i<e.length;i++){const n=e[i],s=e[(i+1)%e.length];t.x+=(n.y-s.y)*(n.z+s.z),t.y+=(n.z-s.z)*(n.x+s.x),t.z+=(n.x-s.x)*(n.y+s.y)}return t.normalize(),t}getNormalTangentAndBitangent(e){const t=this.getNormalNewell(e),n=(Math.abs(t.z)>.5?new v(0,1,0):new v(0,0,1)).cross(t).normalize(),s=t.clone().cross(n).normalize();return{normal:t,tangent:n,bitangent:s}}flattenVertex(e,t,i){return new Ut(e.dot(t),e.dot(i))}genFace(e,t,i,n,s,o,r,a,p,h){let c;if(h>3){const u=[];for(let y=0;y<i.length;y+=3)u.push(new v(t.vertexPositions[i[y]],t.vertexPositions[i[y+1]],t.vertexPositions[i[y+2]]));const{tangent:m,bitangent:g}=this.getNormalTangentAndBitangent(u),w=[];for(const y of u)w.push(this.flattenVertex(y,m,g));c=Yt.triangulateShape(w,[])}else c=[[0,1,2]];for(const[u,m,g]of c)e.vertex.push(t.vertexPositions[i[u*3]]),e.vertex.push(t.vertexPositions[i[u*3+1]]),e.vertex.push(t.vertexPositions[i[u*3+2]]),e.vertex.push(t.vertexPositions[i[m*3]]),e.vertex.push(t.vertexPositions[i[m*3+1]]),e.vertex.push(t.vertexPositions[i[m*3+2]]),e.vertex.push(t.vertexPositions[i[g*3]]),e.vertex.push(t.vertexPositions[i[g*3+1]]),e.vertex.push(t.vertexPositions[i[g*3+2]]),t.skeleton&&(e.vertexWeights.push(a[u*4]),e.vertexWeights.push(a[u*4+1]),e.vertexWeights.push(a[u*4+2]),e.vertexWeights.push(a[u*4+3]),e.vertexWeights.push(a[m*4]),e.vertexWeights.push(a[m*4+1]),e.vertexWeights.push(a[m*4+2]),e.vertexWeights.push(a[m*4+3]),e.vertexWeights.push(a[g*4]),e.vertexWeights.push(a[g*4+1]),e.vertexWeights.push(a[g*4+2]),e.vertexWeights.push(a[g*4+3]),e.weightsIndices.push(p[u*4]),e.weightsIndices.push(p[u*4+1]),e.weightsIndices.push(p[u*4+2]),e.weightsIndices.push(p[u*4+3]),e.weightsIndices.push(p[m*4]),e.weightsIndices.push(p[m*4+1]),e.weightsIndices.push(p[m*4+2]),e.weightsIndices.push(p[m*4+3]),e.weightsIndices.push(p[g*4]),e.weightsIndices.push(p[g*4+1]),e.weightsIndices.push(p[g*4+2]),e.weightsIndices.push(p[g*4+3])),t.color&&(e.colors.push(o[u*3]),e.colors.push(o[u*3+1]),e.colors.push(o[u*3+2]),e.colors.push(o[m*3]),e.colors.push(o[m*3+1]),e.colors.push(o[m*3+2]),e.colors.push(o[g*3]),e.colors.push(o[g*3+1]),e.colors.push(o[g*3+2])),t.material&&t.material.mappingType!=="AllSame"&&(e.materialIndex.push(n),e.materialIndex.push(n),e.materialIndex.push(n)),t.normal&&(e.normal.push(s[u*3]),e.normal.push(s[u*3+1]),e.normal.push(s[u*3+2]),e.normal.push(s[m*3]),e.normal.push(s[m*3+1]),e.normal.push(s[m*3+2]),e.normal.push(s[g*3]),e.normal.push(s[g*3+1]),e.normal.push(s[g*3+2])),t.uv&&t.uv.forEach(function(w,y){e.uvs[y]===void 0&&(e.uvs[y]=[]),e.uvs[y].push(r[y][u*2]),e.uvs[y].push(r[y][u*2+1]),e.uvs[y].push(r[y][m*2]),e.uvs[y].push(r[y][m*2+1]),e.uvs[y].push(r[y][g*2]),e.uvs[y].push(r[y][g*2+1])})}addMorphTargets(e,t,i,n){if(i.length===0)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const s=this;i.forEach(function(o){o.rawTargets.forEach(function(r){const a=L.Objects.Geometry[r.geoID];a!==void 0&&s.genMorphGeometry(e,t,a,n,r.name)})})}genMorphGeometry(e,t,i,n,s){const o=t.PolygonVertexIndex!==void 0?t.PolygonVertexIndex.a:[],r=i.Vertices!==void 0?i.Vertices.a:[],a=i.Indexes!==void 0?i.Indexes.a:[],p=e.attributes.position.count*3,h=new Float32Array(p);for(let g=0;g<a.length;g++){const w=a[g]*3;h[w]=r[g*3],h[w+1]=r[g*3+1],h[w+2]=r[g*3+2]}const c={vertexIndices:o,vertexPositions:h},u=this.genBuffers(c),m=new H(u.vertex,3);m.name=s||i.attrName,m.applyMatrix4(n),e.morphAttributes.position.push(m)}parseNormals(e){const t=e.MappingInformationType,i=e.ReferenceInformationType,n=e.Normals.a;let s=[];return i==="IndexToDirect"&&("NormalIndex"in e?s=e.NormalIndex.a:"NormalsIndex"in e&&(s=e.NormalsIndex.a)),{dataSize:3,buffer:n,indices:s,mappingType:t,referenceType:i}}parseUVs(e){const t=e.MappingInformationType,i=e.ReferenceInformationType,n=e.UV.a;let s=[];return i==="IndexToDirect"&&(s=e.UVIndex.a),{dataSize:2,buffer:n,indices:s,mappingType:t,referenceType:i}}parseVertexColors(e){const t=e.MappingInformationType,i=e.ReferenceInformationType,n=e.Colors.a;let s=[];i==="IndexToDirect"&&(s=e.ColorIndex.a);for(let o=0,r=new W;o<n.length;o+=4)r.fromArray(n,o).convertSRGBToLinear().toArray(n,o);return{dataSize:4,buffer:n,indices:s,mappingType:t,referenceType:i}}parseMaterialIndices(e){const t=e.MappingInformationType,i=e.ReferenceInformationType;if(t==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:i};const n=e.Materials.a,s=[];for(let o=0;o<n.length;++o)s.push(o);return{dataSize:1,buffer:n,indices:s,mappingType:t,referenceType:i}}parseNurbsGeometry(e){const t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new ue;const i=t-1,n=e.KnotVector.a,s=[],o=e.Points.a;for(let c=0,u=o.length;c<u;c+=4)s.push(new Re().fromArray(o,c));let r,a;if(e.Form==="Closed")s.push(s[0]);else if(e.Form==="Periodic"){r=i,a=n.length-1-r;for(let c=0;c<i;++c)s.push(s[c])}const h=new Gn(i,n,s,r,a).getPoints(s.length*12);return new ue().setFromPoints(h)}}class qn{parse(){const e=[],t=this.parseClips();if(t!==void 0)for(const i in t){const n=t[i],s=this.addClip(n);e.push(s)}return e}parseClips(){if(L.Objects.AnimationCurve===void 0)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){const e=L.Objects.AnimationCurveNode,t=new Map;for(const i in e){const n=e[i];if(n.attrName.match(/S|R|T|DeformPercent/)!==null){const s={id:n.id,attr:n.attrName,curves:{}};t.set(s.id,s)}}return t}parseAnimationCurves(e){const t=L.Objects.AnimationCurve;for(const i in t){const n={id:t[i].id,times:t[i].KeyTime.a.map(ti),values:t[i].KeyValueFloat.a},s=B.get(n.id);if(s!==void 0){const o=s.parents[0].ID,r=s.parents[0].relationship;r.match(/X/)?e.get(o).curves.x=n:r.match(/Y/)?e.get(o).curves.y=n:r.match(/Z/)?e.get(o).curves.z=n:r.match(/DeformPercent/)&&e.has(o)&&(e.get(o).curves.morph=n)}}}parseAnimationLayers(e){const t=L.Objects.AnimationLayer,i=new Map;for(const n in t){const s=[],o=B.get(parseInt(n));o!==void 0&&(o.children.forEach(function(a,p){if(e.has(a.ID)){const h=e.get(a.ID);if(h.curves.x!==void 0||h.curves.y!==void 0||h.curves.z!==void 0){if(s[p]===void 0){const c=B.get(a.ID).parents.filter(function(u){return u.relationship!==void 0})[0].ID;if(c!==void 0){const u=L.Objects.Model[c.toString()];if(u===void 0){console.warn("THREE.FBXLoader: Encountered a unused curve.",a);return}const m={modelName:u.attrName?Ce.sanitizeNodeName(u.attrName):"",ID:u.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};Z.traverse(function(g){g.ID===u.id&&(m.transform=g.matrix,g.userData.transformData&&(m.eulerOrder=g.userData.transformData.eulerOrder))}),m.transform||(m.transform=new z),"PreRotation"in u&&(m.preRotation=u.PreRotation.value),"PostRotation"in u&&(m.postRotation=u.PostRotation.value),s[p]=m}}s[p]&&(s[p][h.attr]=h)}else if(h.curves.morph!==void 0){if(s[p]===void 0){const c=B.get(a.ID).parents.filter(function(T){return T.relationship!==void 0})[0].ID,u=B.get(c).parents[0].ID,m=B.get(u).parents[0].ID,g=B.get(m).parents[0].ID,w=L.Objects.Model[g],y={modelName:w.attrName?Ce.sanitizeNodeName(w.attrName):"",morphName:L.Objects.Deformer[c].attrName};s[p]=y}s[p][h.attr]=h}}}),i.set(parseInt(n),s))}return i}parseAnimStacks(e){const t=L.Objects.AnimationStack,i={};for(const n in t){const s=B.get(parseInt(n)).children;s.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const o=e.get(s[0].ID);i[n]={name:t[n].attrName,layer:o}}return i}addClip(e){let t=[];const i=this;return e.layer.forEach(function(n){t=t.concat(i.generateTracks(n))}),new Zt(e.name,-1,t)}generateTracks(e){const t=[];let i=new v,n=new v;if(e.transform&&e.transform.decompose(i,new X,n),i=i.toArray(),n=n.toArray(),e.T!==void 0&&Object.keys(e.T.curves).length>0){const s=this.generateVectorTrack(e.modelName,e.T.curves,i,"position");s!==void 0&&t.push(s)}if(e.R!==void 0&&Object.keys(e.R.curves).length>0){const s=this.generateRotationTrack(e.modelName,e.R.curves,e.preRotation,e.postRotation,e.eulerOrder);s!==void 0&&t.push(s)}if(e.S!==void 0&&Object.keys(e.S.curves).length>0){const s=this.generateVectorTrack(e.modelName,e.S.curves,n,"scale");s!==void 0&&t.push(s)}if(e.DeformPercent!==void 0){const s=this.generateMorphTrack(e);s!==void 0&&t.push(s)}return t}generateVectorTrack(e,t,i,n){const s=this.getTimesForAllAxes(t),o=this.getKeyframeTrackValues(s,t,i);return new Gt(e+"."+n,s,o)}generateRotationTrack(e,t,i,n,s){let o,r;if(t.x!==void 0&&t.y!==void 0&&t.z!==void 0){const c=this.interpolateRotations(t.x,t.y,t.z,s);o=c[0],r=c[1]}i!==void 0&&(i=i.map(G.degToRad),i.push(s),i=new ie().fromArray(i),i=new X().setFromEuler(i)),n!==void 0&&(n=n.map(G.degToRad),n.push(s),n=new ie().fromArray(n),n=new X().setFromEuler(n).invert());const a=new X,p=new ie,h=[];if(!r||!o)return new $e(e+".quaternion",[],[]);for(let c=0;c<r.length;c+=3)p.set(r[c],r[c+1],r[c+2],s),a.setFromEuler(p),i!==void 0&&a.premultiply(i),n!==void 0&&a.multiply(n),c>2&&new X().fromArray(h,(c-3)/3*4).dot(a)<0&&a.set(-a.x,-a.y,-a.z,-a.w),a.toArray(h,c/3*4);return new $e(e+".quaternion",o,h)}generateMorphTrack(e){const t=e.DeformPercent.curves.morph,i=t.values.map(function(s){return s/100}),n=Z.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new Ht(e.modelName+".morphTargetInfluences["+n+"]",t.times,i)}getTimesForAllAxes(e){let t=[];if(e.x!==void 0&&(t=t.concat(e.x.times)),e.y!==void 0&&(t=t.concat(e.y.times)),e.z!==void 0&&(t=t.concat(e.z.times)),t=t.sort(function(i,n){return i-n}),t.length>1){let i=1,n=t[0];for(let s=1;s<t.length;s++){const o=t[s];o!==n&&(t[i]=o,n=o,i++)}t=t.slice(0,i)}return t}getKeyframeTrackValues(e,t,i){const n=i,s=[];let o=-1,r=-1,a=-1;return e.forEach(function(p){if(t.x&&(o=t.x.times.indexOf(p)),t.y&&(r=t.y.times.indexOf(p)),t.z&&(a=t.z.times.indexOf(p)),o!==-1){const h=t.x.values[o];s.push(h),n[0]=h}else s.push(n[0]);if(r!==-1){const h=t.y.values[r];s.push(h),n[1]=h}else s.push(n[1]);if(a!==-1){const h=t.z.values[a];s.push(h),n[2]=h}else s.push(n[2])}),s}interpolateRotations(e,t,i,n){const s=[],o=[];s.push(e.times[0]),o.push(G.degToRad(e.values[0])),o.push(G.degToRad(t.values[0])),o.push(G.degToRad(i.values[0]));for(let r=1;r<e.values.length;r++){const a=[e.values[r-1],t.values[r-1],i.values[r-1]];if(isNaN(a[0])||isNaN(a[1])||isNaN(a[2]))continue;const p=a.map(G.degToRad),h=[e.values[r],t.values[r],i.values[r]];if(isNaN(h[0])||isNaN(h[1])||isNaN(h[2]))continue;const c=h.map(G.degToRad),u=[h[0]-a[0],h[1]-a[1],h[2]-a[2]],m=[Math.abs(u[0]),Math.abs(u[1]),Math.abs(u[2])];if(m[0]>=180||m[1]>=180||m[2]>=180){const w=Math.max(...m)/180,y=new ie(...p,n),T=new ie(...c,n),P=new X().setFromEuler(y),M=new X().setFromEuler(T);P.dot(M)&&M.set(-M.x,-M.y,-M.z,-M.w);const A=e.times[r-1],k=e.times[r]-A,x=new X,b=new ie;for(let D=0;D<1;D+=1/w)x.copy(P.clone().slerp(M.clone(),D)),s.push(A+D*k),b.setFromQuaternion(x,n),o.push(b.x),o.push(b.y),o.push(b.z)}else s.push(e.times[r]),o.push(G.degToRad(e.values[r])),o.push(G.degToRad(t.values[r])),o.push(G.degToRad(i.values[r]))}return[s,o]}}class Kn{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new vt,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const t=this,i=e.split(/[\r\n]+/);return i.forEach(function(n,s){const o=n.match(/^[\s\t]*;/),r=n.match(/^[\s\t]*$/);if(o||r)return;const a=n.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),p=n.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),h=n.match("^\\t{"+(t.currentIndent-1)+"}}");a?t.parseNodeBegin(n,a):p?t.parseNodeProperty(n,p,i[++s]):h?t.popStack():n.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(n)}),this.allNodes}parseNodeBegin(e,t){const i=t[1].trim().replace(/^"/,"").replace(/"$/,""),n=t[2].split(",").map(function(a){return a.trim().replace(/^"/,"").replace(/"$/,"")}),s={name:i},o=this.parseNodeAttr(n),r=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(i,s):i in r?(i==="PoseNode"?r.PoseNode.push(s):r[i].id!==void 0&&(r[i]={},r[i][r[i].id]=r[i]),o.id!==""&&(r[i][o.id]=s)):typeof o.id=="number"?(r[i]={},r[i][o.id]=s):i!=="Properties70"&&(i==="PoseNode"?r[i]=[s]:r[i]=s),typeof o.id=="number"&&(s.id=o.id),o.name!==""&&(s.attrName=o.name),o.type!==""&&(s.attrType=o.type),this.pushStack(s)}parseNodeAttr(e){let t=e[0];e[0]!==""&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let i="",n="";return e.length>1&&(i=e[1].replace(/^(\w+)::/,""),n=e[2]),{id:t,name:i,type:n}}parseNodeProperty(e,t,i){let n=t[1].replace(/^"/,"").replace(/"$/,"").trim(),s=t[2].replace(/^"/,"").replace(/"$/,"").trim();n==="Content"&&s===","&&(s=i.replace(/"/g,"").replace(/,$/,"").trim());const o=this.getCurrentNode();if(o.name==="Properties70"){this.parseNodeSpecialProperty(e,n,s);return}if(n==="C"){const a=s.split(",").slice(1),p=parseInt(a[0]),h=parseInt(a[1]);let c=s.split(",").slice(3);c=c.map(function(u){return u.trim().replace(/^"/,"")}),n="connections",s=[p,h],ii(s,c),o[n]===void 0&&(o[n]=[])}n==="Node"&&(o.id=s),n in o&&Array.isArray(o[n])?o[n].push(s):n!=="a"?o[n]=s:o.a=s,this.setCurrentProp(o,n),n==="a"&&s.slice(-1)!==","&&(o.a=Qe(s))}parseNodePropertyContinued(e){const t=this.getCurrentNode();t.a+=e,e.slice(-1)!==","&&(t.a=Qe(t.a))}parseNodeSpecialProperty(e,t,i){const n=i.split('",').map(function(h){return h.trim().replace(/^\"/,"").replace(/\s/,"_")}),s=n[0],o=n[1],r=n[2],a=n[3];let p=n[4];switch(o){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":p=parseFloat(p);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":p=Qe(p);break}this.getPrevNode()[s]={type:o,type2:r,flag:a,value:p},this.setCurrentProp(this.getPrevNode(),s)}}class $n{parse(e){const t=new rt(e);t.skip(23);const i=t.getUint32();if(i<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+i);const n=new vt;for(;!this.endOfContent(t);){const s=this.parseNode(t,i);s!==null&&n.add(s.name,s)}return n}endOfContent(e){return e.size()%16===0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){const i={},n=t>=7500?e.getUint64():e.getUint32(),s=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();const o=e.getUint8(),r=e.getString(o);if(n===0)return null;const a=[];for(let u=0;u<s;u++)a.push(this.parseProperty(e));const p=a.length>0?a[0]:"",h=a.length>1?a[1]:"",c=a.length>2?a[2]:"";for(i.singleProperty=s===1&&e.getOffset()===n;n>e.getOffset();){const u=this.parseNode(e,t);u!==null&&this.parseSubNode(r,i,u)}return i.propertyList=a,typeof p=="number"&&(i.id=p),h!==""&&(i.attrName=h),c!==""&&(i.attrType=c),r!==""&&(i.name=r),i}parseSubNode(e,t,i){if(i.singleProperty===!0){const n=i.propertyList[0];Array.isArray(n)?(t[i.name]=i,i.a=n):t[i.name]=n}else if(e==="Connections"&&i.name==="C"){const n=[];i.propertyList.forEach(function(s,o){o!==0&&n.push(s)}),t.connections===void 0&&(t.connections=[]),t.connections.push(n)}else if(i.name==="Properties70")Object.keys(i).forEach(function(s){t[s]=i[s]});else if(e==="Properties70"&&i.name==="P"){let n=i.propertyList[0],s=i.propertyList[1];const o=i.propertyList[2],r=i.propertyList[3];let a;n.indexOf("Lcl ")===0&&(n=n.replace("Lcl ","Lcl_")),s.indexOf("Lcl ")===0&&(s=s.replace("Lcl ","Lcl_")),s==="Color"||s==="ColorRGB"||s==="Vector"||s==="Vector3D"||s.indexOf("Lcl_")===0?a=[i.propertyList[4],i.propertyList[5],i.propertyList[6]]:a=i.propertyList[4],t[n]={type:s,type2:o,flag:r,value:a}}else t[i.name]===void 0?typeof i.id=="number"?(t[i.name]={},t[i.name][i.id]=i):t[i.name]=i:i.name==="PoseNode"?(Array.isArray(t[i.name])||(t[i.name]=[t[i.name]]),t[i.name].push(i)):t[i.name][i.id]===void 0&&(t[i.name][i.id]=i)}parseProperty(e){const t=e.getString(1);let i;switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return i=e.getUint32(),e.getArrayBuffer(i);case"S":return i=e.getUint32(),e.getString(i);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const n=e.getUint32(),s=e.getUint32(),o=e.getUint32();if(s===0)switch(t){case"b":case"c":return e.getBooleanArray(n);case"d":return e.getFloat64Array(n);case"f":return e.getFloat32Array(n);case"i":return e.getInt32Array(n);case"l":return e.getInt64Array(n)}const r=On(new Uint8Array(e.getArrayBuffer(o))),a=new rt(r.buffer);switch(t){case"b":case"c":return a.getBooleanArray(n);case"d":return a.getFloat64Array(n);case"f":return a.getFloat32Array(n);case"i":return a.getInt32Array(n);case"l":return a.getInt64Array(n)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}}class rt{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=t!==void 0?t:!0,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(this.getUint8()&1)===1}getBooleanArray(e){const t=[];for(let i=0;i<e;i++)t.push(this.getBoolean());return t}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const t=[];for(let i=0;i<e;i++)t.push(this.getInt32());return t}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t&2147483648?(t=~t&4294967295,e=~e&4294967295,e===4294967295&&(t=t+1&4294967295),e=e+1&4294967295,-(t*4294967296+e)):t*4294967296+e}getInt64Array(e){const t=[];for(let i=0;i<e;i++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t*4294967296+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const t=[];for(let i=0;i<e;i++)t.push(this.getFloat32());return t}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const t=[];for(let i=0;i<e;i++)t.push(this.getFloat64());return t}getArrayBuffer(e){const t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){const t=this.offset;let i=new Uint8Array(this.dv.buffer,t,e);this.skip(e);const n=i.indexOf(0);return n>=0&&(i=new Uint8Array(this.dv.buffer,t,n)),this._textDecoder.decode(i)}}class vt{add(e,t){this[e]=t}}function Jn(l){const e="Kaydara FBX Binary  \0";return l.byteLength>=e.length&&e===St(l,0,e.length)}function ei(l){const e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let t=0;function i(n){const s=l[n-1];return l=l.slice(t+n),t++,s}for(let n=0;n<e.length;++n)if(i(1)===e[n])return!1;return!0}function ot(l){const e=/FBXVersion: (\d+)/,t=l.match(e);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function ti(l){return l/46186158e3}const ni=[];function Le(l,e,t,i){let n;switch(i.mappingType){case"ByPolygonVertex":n=l;break;case"ByPolygon":n=e;break;case"ByVertice":n=t;break;case"AllSame":n=i.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+i.mappingType)}i.referenceType==="IndexToDirect"&&(n=i.indices[n]);const s=n*i.dataSize,o=s+i.dataSize;return si(ni,i.buffer,s,o)}const Be=new ie,we=new v;function xt(l){const e=new z,t=new z,i=new z,n=new z,s=new z,o=new z,r=new z,a=new z,p=new z,h=new z,c=new z,u=new z,m=l.inheritType?l.inheritType:0;if(l.translation&&e.setPosition(we.fromArray(l.translation)),l.preRotation){const Q=l.preRotation.map(G.degToRad);Q.push(l.eulerOrder||ie.DEFAULT_ORDER),t.makeRotationFromEuler(Be.fromArray(Q))}if(l.rotation){const Q=l.rotation.map(G.degToRad);Q.push(l.eulerOrder||ie.DEFAULT_ORDER),i.makeRotationFromEuler(Be.fromArray(Q))}if(l.postRotation){const Q=l.postRotation.map(G.degToRad);Q.push(l.eulerOrder||ie.DEFAULT_ORDER),n.makeRotationFromEuler(Be.fromArray(Q)),n.invert()}l.scale&&s.scale(we.fromArray(l.scale)),l.scalingOffset&&r.setPosition(we.fromArray(l.scalingOffset)),l.scalingPivot&&o.setPosition(we.fromArray(l.scalingPivot)),l.rotationOffset&&a.setPosition(we.fromArray(l.rotationOffset)),l.rotationPivot&&p.setPosition(we.fromArray(l.rotationPivot)),l.parentMatrixWorld&&(c.copy(l.parentMatrix),h.copy(l.parentMatrixWorld));const g=t.clone().multiply(i).multiply(n),w=new z;w.extractRotation(h);const y=new z;y.copyPosition(h);const T=y.clone().invert().multiply(h),P=w.clone().invert().multiply(T),M=s,A=new z;if(m===0)A.copy(w).multiply(g).multiply(P).multiply(M);else if(m===1)A.copy(w).multiply(P).multiply(g).multiply(M);else{const re=new z().scale(new v().setFromMatrixScale(c)).clone().invert(),J=P.clone().multiply(re);A.copy(w).multiply(g).multiply(J).multiply(M)}const k=p.clone().invert(),x=o.clone().invert();let b=e.clone().multiply(a).multiply(p).multiply(t).multiply(i).multiply(n).multiply(k).multiply(r).multiply(o).multiply(s).multiply(x);const D=new z().copyPosition(b),$=h.clone().multiply(D);return u.copyPosition($),b=u.clone().multiply(A),b.premultiply(h.invert()),b}function bt(l){l=l||0;const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return l===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[l]}function Qe(l){return l.split(",").map(function(t){return parseFloat(t)})}function St(l,e,t){return e===void 0&&(e=0),t===void 0&&(t=l.byteLength),new TextDecoder().decode(new Uint8Array(l,e,t))}function ii(l,e){for(let t=0,i=l.length,n=e.length;t<n;t++,i++)l[i]=e[t]}function si(l,e,t,i){for(let n=t,s=0;n<i;n++,s++)l[s]=e[n];return l}const Ae=new Nt,ri={glb:new Je(Ae),gltf:new Je(Ae),obj:new Pn(Ae),fbx:new Hn(Ae)};async function oi(l){var e;try{const t=(e=l.split(".").pop())==null?void 0:e.toLowerCase(),i=ri[t];if(!i)throw new Error(`Unsupported file format: ${t}`);return new Promise((n,s)=>{i.load(l,o=>{const r="scene"in o?o.scene:o,a=new Wt().setFromObject(r),p=a.getCenter(new v),h=a.getSize(new v),u=2/Math.max(h.x,h.y,h.z);r.position.sub(p),r.scale.multiplyScalar(u),r.traverse(m=>{m instanceof S&&(m.castShadow=!0,m.receiveShadow=!0,m.material&&(Array.isArray(m.material)?m.material.forEach(g=>{g.needsUpdate=!0,g.side=je}):(m.material.needsUpdate=!0,m.material.side=je)))}),n(r)},o=>{const r=(o.loaded/o.total*100).toFixed(2);console.log(`Loading progress: ${r}%`)},o=>{console.error("Error loading model:",o),s(o)})})}catch(t){throw console.error("Error in loadModel:",t),t}}const ai=({object:l,transformMode:e})=>{const t=j.useRef(null),[i,n]=j.useState(null),[s,o]=j.useState(null),r=Se(h=>h.updateObject),a=Se(h=>h.setSelectedObjectId);j.useEffect(()=>{let h=!0;return(async()=>{try{const u=await oi(l.url);h&&(n(u),o(null))}catch(u){h&&(console.error("Failed to load model:",u),o(u instanceof Error?u.message:"Failed to load model"))}})(),()=>{h=!1,i&&i.traverse(u=>{u instanceof S&&(u.geometry&&u.geometry.dispose(),u.material&&(Array.isArray(u.material)?u.material.forEach(m=>m.dispose()):u.material.dispose()))})}},[l.url]);const p=()=>{if(t.current){const{position:h,rotation:c,scale:u}=t.current;r(l.id,{position:[h.x,h.y,h.z],rotation:[c.x,c.y,c.z],scale:[u.x,u.y,u.z]})}};return s?null:E.jsxs("group",{ref:t,position:l.position,rotation:l.rotation,scale:l.scale,onClick:h=>{h.stopPropagation(),a(l.id)},children:[e&&E.jsx(mn,{mode:e,object:t,onObjectChange:p}),i&&E.jsx("primitive",{object:i})]})},li=({light:l})=>{const e=j.useRef(null);switch(gn(l.type!=="ambient"?e:null,l.type==="directional"?qt:l.type==="point"?Kt:l.type==="spot"?$t:null,1,l.color),l.type){case"ambient":return E.jsx("ambientLight",{ref:e,intensity:l.intensity,color:l.color});case"directional":return E.jsx("directionalLight",{ref:e,intensity:l.intensity,position:l.position,color:l.color,castShadow:!0});case"point":return E.jsx("pointLight",{ref:e,intensity:l.intensity,position:l.position,color:l.color,castShadow:!0});case"spot":return E.jsx("spotLight",{ref:e,intensity:l.intensity,position:l.position,"target-position":l.target,color:l.color,castShadow:!0,angle:Math.PI/6,penumbra:1});default:return null}},ci=()=>{const{objects:l,selectedObjectId:e,setSelectedObjectId:t,removeObject:i}=Se();return E.jsxs("div",{className:"absolute top-4 right-4 w-64 bg-[#121214] border border-[#242429] rounded-lg overflow-hidden",children:[E.jsx("div",{className:"p-4 border-b border-[#242429]",children:E.jsx("h2",{className:"text-sm font-medium text-white",children:"Scene Objects"})}),E.jsx("div",{className:"max-h-96 overflow-y-auto",children:l.map(n=>E.jsxs("div",{className:`flex items-center justify-between p-4 cursor-pointer hover:bg-[#242429] ${e===n.id?"bg-[#242429]":""}`,onClick:()=>t(n.id),children:[E.jsxs("div",{children:[E.jsx("p",{className:"text-sm font-medium text-white",children:n.name}),E.jsx("p",{className:"text-xs text-gray-400",children:n.type.toUpperCase()})]}),E.jsx("button",{onClick:s=>{s.stopPropagation(),i(n.id)},className:"p-1 hover:bg-red-500/20 rounded-lg group",children:E.jsx(cn,{className:"w-4 h-4 text-gray-400 group-hover:text-red-500"})})]},n.id))})]})},hi=()=>{const{lights:l,addLight:e,removeLight:t,updateLight:i}=pt(),n=[{type:"ambient",icon:ln,label:"Ambient"},{type:"directional",icon:nn,label:"Directional"},{type:"point",icon:on,label:"Point"},{type:"spot",icon:an,label:"Spot"}];return E.jsx("div",{className:"absolute top-4 left-1/2 -translate-x-1/2 bg-[#121214] border border-[#242429] rounded-lg p-2",children:E.jsx("div",{className:"flex gap-2",children:n.map(({type:s,icon:o,label:r})=>E.jsxs("button",{onClick:()=>e(s),className:"p-2 hover:bg-[#242429] rounded-lg group flex flex-col items-center gap-1",title:`Add ${r} Light`,children:[E.jsx(o,{className:"w-5 h-5 text-gray-400 group-hover:text-white"}),E.jsx("span",{className:"text-xs text-gray-400 group-hover:text-white",children:r})]},s))})})},pi=()=>{const[l,e]=j.useState("translate"),{objects:t,selectedObjectId:i}=Se(),{lights:n}=pt();return E.jsxs("div",{className:"relative w-full h-full",children:[E.jsxs(Jt,{shadows:!0,camera:{position:[5,5,5],fov:50},gl:{preserveDrawingBuffer:!0},children:[E.jsx("color",{attach:"background",args:["#0a0a0b"]}),n.map(s=>E.jsx(li,{light:s},s.id)),E.jsx(sn,{args:[30,30],cellSize:1,cellThickness:1,cellColor:"#242429",sectionSize:3,sectionThickness:1.5,sectionColor:"#1a1a1f",fadeDistance:30,fadeStrength:1,followCamera:!1}),E.jsxs("mesh",{position:[0,.5,0],castShadow:!0,receiveShadow:!0,children:[E.jsx("sphereGeometry",{args:[.5,32,32]}),E.jsx("meshStandardMaterial",{color:"#ffffff"})]}),t.map(s=>E.jsx(ai,{object:s,transformMode:i===s.id?l:null},s.id)),E.jsx(en,{makeDefault:!0})]}),E.jsx(yn,{}),E.jsx(ci,{}),E.jsx(hi,{}),E.jsx("div",{className:"absolute top-4 left-4 flex gap-2",children:["translate","rotate","scale"].map(s=>E.jsx("button",{onClick:()=>e(s),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${l===s?"bg-blue-500 text-white":"bg-[#121214] text-gray-400 hover:bg-[#242429] hover:text-white"}`,children:s.charAt(0).toUpperCase()+s.slice(1)},s))})]})},wi=()=>E.jsx("div",{className:"h-[calc(100vh-44px)] bg-[#0a0a0b]",children:E.jsx(rn,{FallbackComponent:({error:l})=>E.jsx("div",{className:"w-full h-full flex items-center justify-center text-red-400",children:E.jsxs("p",{children:["Error loading scene: ",l.message]})}),children:E.jsx(j.Suspense,{fallback:E.jsx(Pt,{}),children:E.jsx(pi,{})})})});export{wi as default};
